<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>××¨×›×– ×©×™×¨×•×ª ×‘×¨×¢"×</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;800&display=swap');
        body { font-family: 'Assistant', sans-serif; background: #f4f7fa; }
        .vag-blue { background: linear-gradient(135deg, #001e50 0%, #004080 100%); }
        .page { display: none; animation: slideUp 0.3s ease-out; }
        .page.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        canvas { border: 2px dashed #cbd5e1; border-radius: 12px; background: #fff; width: 100%; height: 150px; }
        .quote-doc { border-top: 10px solid #001e50; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-slate-50">

    <header class="vag-blue pt-8 pb-16 px-6 text-white text-center rounded-b-[3rem] shadow-xl relative z-0">
        <h1 class="text-3xl font-black italic tracking-tighter">××¨×›×– ×©×™×¨×•×ª ×‘×¨×¢"×</h1>
        <p class="text-blue-200 text-xs font-bold uppercase tracking-widest">VAG Group Excellence</p>
        <div id="garageStatus" class="mt-3 inline-flex items-center gap-2 bg-white/10 px-4 py-1 rounded-full text-[10px] font-bold">
            <span id="statusDot" class="w-2 h-2 rounded-full bg-gray-400"></span>
            <span id="statusText">×˜×•×¢×Ÿ...</span>
        </div>
    </header>

    <main class="max-w-md mx-auto px-5 -mt-10 relative z-10">
        
        <div id="home" class="page active space-y-4">
            <div class="grid grid-cols-2 gap-3">
                <a href="tel:086277195" class="bg-white p-5 rounded-3xl shadow-sm text-center border-b-4 border-blue-600">
                    <i class="fas fa-phone-alt text-blue-600 mb-2"></i>
                    <span class="block text-xs font-black">×—×™×•×’ ×œ××•×¡×š</span>
                </a>
                <a href="https://waze.com/ul?q=×¤× ×—×¡ ×”×—×•×¦×‘ 35 ×‘××¨ ×©×‘×¢" class="bg-white p-5 rounded-3xl shadow-sm text-center border-b-4 border-blue-400">
                    <i class="fas fa-map-marker-alt text-blue-400 mb-2"></i>
                    <span class="block text-xs font-black">× ×™×•×•×˜ ×‘×•×•×™×–</span>
                </a>
            </div>

            <div class="bg-amber-50 p-4 rounded-2xl border border-amber-200 flex items-center gap-3">
                <span class="text-xl">ğŸ’¡</span>
                <p id="tipDisplay" class="text-amber-900 text-[11px] font-bold italic"></p>
            </div>

            <button onclick="nav('login')" class="w-full bg-slate-900 text-white p-5 rounded-3xl flex items-center justify-between shadow-lg">
                <div class="text-right">
                    <h3 class="font-black italic">××–×•×¨ ××™×©×™</h3>
                    <p class="text-[9px] opacity-60">××¢×§×‘ ×ª×™×§×•×Ÿ ×•×”×¦×¢×•×ª ××—×™×¨</p>
                </div>
                <i class="fas fa-arrow-left"></i>
            </button>

            <button onclick="nav('reg')" class="w-full bg-white text-blue-900 p-5 rounded-3xl flex items-center justify-between shadow-sm border border-gray-100">
                <div class="text-right">
                    <h3 class="font-black italic text-sm">×œ×§×•×— ×—×“×©? ×¨×©×•× ×¨×›×‘</h3>
                    <p class="text-[9px] opacity-60">×¤×ª×™×—×ª ×›×¨×˜×™×¡ ××”×™×¨×” ×‘××¢×¨×›×ª</p>
                </div>
                <i class="fas fa-plus-circle text-blue-600"></i>
            </button>
        </div>

        <div id="reg" class="page bg-white p-6 rounded-[2rem] shadow-xl space-y-3">
            <h2 class="text-xl font-black italic text-blue-900 mb-2">×¨×™×©×•× ×œ×§×•×— ×—×“×©</h2>
            <div class="grid grid-cols-2 gap-2">
                <input id="rF" placeholder="×©× ×¤×¨×˜×™" class="w-full p-3 bg-gray-50 rounded-xl text-sm border-none outline-none">
                <input id="rL" placeholder="×©× ××©×¤×—×”" class="w-full p-3 bg-gray-50 rounded-xl text-sm border-none outline-none">
            </div>
            <input id="rI" type="number" placeholder="×ª×¢×•×“×ª ×–×”×•×ª" class="w-full p-3 bg-gray-50 rounded-xl text-sm border-none">
            <input id="rP" placeholder="××¡×¤×¨ ×¨×›×‘" class="w-full p-3 bg-blue-50 rounded-xl text-sm font-black text-center border-none">
            <input id="rM" placeholder="×“×’× ×¨×›×‘" class="w-full p-3 bg-gray-50 rounded-xl text-sm border-none">
            <button onclick="register()" class="w-full vag-blue text-white p-4 rounded-2xl font-black shadow-lg">×‘×¦×¢ ×¨×™×©×•×</button>
            <button onclick="nav('home')" class="w-full text-gray-400 text-xs">×‘×™×˜×•×œ</button>
        </div>

        <div id="login" class="page bg-white p-8 rounded-[2rem] shadow-xl space-y-4">
            <h2 class="text-xl font-black italic text-center">×”×ª×—×‘×¨×•×ª ×œ××¢×¨×›×ª</h2>
            <input id="lP" placeholder="××¡×¤×¨ ×¨×›×‘" class="w-full p-4 bg-gray-50 rounded-2xl text-center font-black text-lg outline-none shadow-inner">
            <input id="lI" type="number" placeholder="×ª×¢×•×“×ª ×–×”×•×ª" class="w-full p-4 bg-gray-50 rounded-2xl text-center outline-none shadow-inner">
            <button onclick="login()" class="w-full vag-blue text-white p-4 rounded-2xl font-black shadow-lg">×›× ×™×¡×” ×œ××–×•×¨ ×”××™×©×™</button>
            <button onclick="nav('home')" class="w-full text-gray-400 text-xs uppercase font-bold tracking-widest">×—×–×•×¨</button>
        </div>

        <div id="dash" class="page space-y-4">
            <div class="bg-white p-5 rounded-[2rem] shadow-sm flex justify-between items-center border-r-8 border-blue-600">
                <div>
                    <h2 class="text-lg font-black italic">×©×œ×•×, <span id="uN" class="text-blue-600"></span></h2>
                    <p id="uC" class="text-[10px] font-bold text-gray-400"></p>
                </div>
                <button onclick="nav('home')" class="bg-gray-100 p-2 rounded-xl text-gray-400"><i class="fas fa-home"></i></button>
            </div>

            <div class="bg-white p-4 rounded-2xl shadow-sm text-center">
                <span class="text-[9px] text-gray-400 font-black uppercase">×¡×˜×˜×•×¡ × ×•×›×—×™:</span>
                <div id="uS" class="text-xl font-black text-blue-900 italic">××¢×“×›×Ÿ...</div>
            </div>

            <div id="qArea" class="hidden quote-doc bg-white p-6 rounded-2xl space-y-4 relative overflow-hidden">
                <div class="flex justify-between items-start border-b pb-4">
                    <div>
                        <h3 class="font-black text-blue-900 uppercase">×”×¦×¢×ª ××—×™×¨</h3>
                        <p class="text-[9px] text-gray-400" id="qD"></p>
                    </div>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Volkswagen_logo_2019.svg/100px-Volkswagen_logo_2019.svg.png" class="w-8 opacity-20">
                </div>
                <table class="w-full text-xs text-right">
                    <tbody id="qI" class="divide-y divide-gray-50"></tbody>
                </table>
                <div class="flex justify-between items-center font-black text-lg pt-2">
                    <span>×¡×”"×›:</span>
                    <span id="qT" class="text-blue-700 font-black"></span>
                </div>
                <div class="pt-4 space-y-2 border-t">
                    <p class="text-[10px] font-bold text-gray-400">×—×ª×™××” ×œ××™×©×•×¨ ×‘×™×¦×•×¢:</p>
                    <canvas id="sig"></canvas>
                    <button onclick="approve()" class="w-full bg-green-600 text-white p-4 rounded-xl font-black shadow-lg">××©×¨ ×•×—×ª×•× ×œ×‘×™×¦×•×¢ âœ…</button>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-2xl shadow-sm">
                <h3 class="font-black text-sm mb-3"><i class="fas fa-history ml-2 text-blue-600"></i>×”×™×¡×˜×•×¨×™×™×ª ×˜×™×¤×•×œ×™×</h3>
                <div id="hL" class="space-y-3 text-xs text-gray-400 italic">××™×Ÿ ×”×™×¡×˜×•×¨×™×”.</div>
            </div>
        </div>
    </main>

    <script>
        // --- Firebase & Config ---
        const config = {
            apiKey: "AIzaSyDD7YAdTePRWYjwBbmy3gLRYd_OLDwpTL8",
            authDomain: "baram-vag-45e12.firebaseapp.com",
            projectId: "baram-vag-45e12",
            storageBucket: "baram-vag-45e12.firebasestorage.app",
            messagingSenderId: "761383355945",
            appId: "1:761383355945:web:552554b5a6b9fe5e78be38"
        };
        firebase.initializeApp(config);
        const db = firebase.firestore();
        let sp, cP;

        // --- UI Logic ---
        function nav(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            window.scrollTo(0,0);
        }

        function updateStatus() {
            const now = new Date();
            const day = now.getDay();
            const hr = now.getHours() + now.getMinutes()/60;
            const open = (day < 5 && hr >= 7.5 && hr < 15.5);
            document.getElementById('statusText').innerText = open ? "×”××•×¡×š ×¤×ª×•×— ×¢×›×©×™×•" : "×”××•×¡×š ×¡×’×•×¨ ×›×¨×’×¢";
            document.getElementById('statusDot').className = `w-2 h-2 rounded-full ${open ? 'bg-green-500 shadow-[0_0_8px_#22c55e]' : 'bg-red-500'}`;
        }

        const tips = ["×‘×“×•×§ ×©××Ÿ ×•××™× ×¤×¢× ×‘×©×‘×•×¢×™×™×.", "×©××Ÿ ×’×™×¨ DSG ××—×œ×™×¤×™× ×›×œ 60,000 ×§\"×.", "× ×•×–×œ ×§×™×¨×•×¨ ×ª×§×Ÿ G13 ×‘×œ×‘×“!", "×œ×—×¥ ××•×•×™×¨ ×ª×§×™×Ÿ ×—×•×¡×š ×“×œ×§."];

        // --- Actions ---
        async function register() {
            const p = document.getElementById('rP').value.trim();
            const i = document.getElementById('rI').value.trim();
            if(!p || !i) return alert("×—×¡×¨ ××¡×¤×¨ ×¨×›×‘ ××• ×ª×¢×•×“×ª ×–×”×•×ª");
            await db.collection("customers").doc(p).set({
                fName: document.getElementById('rF').value, lName: document.getElementById('rL').value,
                id: i, plate: p, model: document.getElementById('rM').value, status: "×œ×§×•×— ×—×“×©", history: [], quotes: []
            });
            alert("× ×¨×©××ª ×‘×”×¦×œ×—×”!"); nav('login');
        }

        async function login() {
            const p = document.getElementById('lP').value.trim();
            const i = document.getElementById('lI').value.trim();
            const doc = await db.collection("customers").doc(p).get();
            if(doc.exists && doc.data().id === i) {
                cP = p; nav('dash');
                db.collection("customers").doc(p).onSnapshot(s => render(s.data()));
            } else alert("×¤×¨×˜×™× ×©×’×•×™×™×");
        }

        function render(d) {
            document.getElementById('uN').innerText = d.fName;
            document.getElementById('uC').innerText = `${d.plate} | ${d.model || ''}`;
            document.getElementById('uS').innerText = d.status || "×‘×‘×“×™×§×”";
            
            // History
            const h = document.getElementById('hL'); h.innerHTML = "";
            (d.history || []).forEach(x => h.innerHTML += `<div class="p-2 bg-gray-50 rounded-lg border-r-2 border-blue-200">${x.date}: ${x.work}</div>`);

            // Quote
            const q = (d.quotes || []).find(x => !x.signed);
            if(q) {
                document.getElementById('qArea').classList.remove('hidden');
                document.getElementById('qD').innerText = `×ª××¨×™×š: ${q.date || new Date().toLocaleDateString('he-IL')}`;
                const tbody = document.getElementById('qI'); tbody.innerHTML = "";
                q.items.forEach(i => tbody.innerHTML += `<tr><td class="py-2">${i.desc}</td><td class="py-2 text-left font-bold">${i.total}â‚ª</td></tr>`);
                document.getElementById('qT').innerText = q.grandTotal + " â‚ª";
                if(!sp) {
                    const canvas = document.getElementById('sig');
                    sp = new SignaturePad(canvas);
                    // ×ª×™×§×•×Ÿ ×¨×–×•×œ×•×¦×™×” ×œ××’×¢
                    const ratio = Math.max(window.devicePixelRatio || 1, 1);
                    canvas.width = canvas.offsetWidth * ratio; canvas.height = canvas.offsetHeight * ratio;
                    canvas.getContext("2d").scale(ratio, ratio);
                }
            } else document.getElementById('qArea').classList.add('hidden');
        }

        async function approve() {
            if(!sp || sp.isEmpty()) return alert("× × ×œ×—×ª×•× ×œ××™×©×•×¨");
            const docRef = db.collection("customers").doc(cP);
            const d = (await docRef.get()).data();
            const qs = d.quotes.map(q => !q.signed ? {...q, signed: true, signedAt: new Date().toISOString()} : q);
            await docRef.update({ quotes: qs, signature: sp.toDataURL(), status: "×”×¦×¢×” ××•×©×¨×” - ×‘×¢×‘×•×“×”" });
            alert("×”×”×¦×¢×” ××•×©×¨×”! ×”×ª×—×œ× ×• ×‘×¢×‘×•×“×”.");
        }

        window.onload = () => {
            updateStatus();
            document.getElementById('tipDisplay').innerText = tips[Math.floor(Math.random()*tips.length)];
            setInterval(updateStatus, 60000);
        };
    </script>
</body>
</html>
