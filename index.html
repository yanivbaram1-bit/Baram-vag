<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>מרכז שירות ברע״מ | VAG Expert</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700;800&display=swap');
        body { font-family: 'Assistant', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .hero-bg, .reviews-section { background: linear-gradient(135deg, #0f172a 0%, #1e40af 100%); }
        .floating-container { position: relative; z-index: 20; margin-top: -50px; }
        .card { background: white; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); border: 1px solid #e2e8f0; }
        .service-box { background: white; border-radius: 18px; padding: 15px; text-align: center; border: 1px solid #e2e8f0; }
        .service-box i { color: #2563eb; font-size: 1.5rem; margin-bottom: 8px; display: block; }
        .btn-action { background: white; border-radius: 12px; padding: 12px 5px; display: flex; align-items: center; justify-content: center; gap: 6px; font-weight: 800; font-size: 13px; color: #1e3a8a; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .review-card-dark { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 20px; color: white; }
        .ai-response-box { background: #f0f7ff; border-right: 4px solid #2563eb; border-radius: 12px; padding: 15px; font-size: 13px; line-height: 1.6; }
        .hidden { display: none; }
        input, textarea { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 12px; outline: none; }
    </style>
</head>
<body>

    <header class="bg-white p-4 border-b sticky top-0 z-50 grid grid-cols-3 items-center">
        <div id="userGreeting" class="text-[10px] font-extrabold text-blue-600 truncate"></div>
        <h1 class="text-lg font-black text-blue-900 text-center whitespace-nowrap">מרכז שירות ברע״מ</h1>
        <div class="text-left">
            <button id="logoutBtn" onclick="location.reload()" class="hidden text-red-500 text-[10px] font-bold bg-red-50 px-2 py-1 rounded border border-red-100 uppercase">יציאה</button>
        </div>
    </header>

    <div id="homePage">
        <section class="hero-bg text-white pt-8 pb-16 px-6 text-center">
            <h2 class="text-2xl font-bold mb-1 italic">VAG SPECIALIST</h2>
            <p class="text-blue-200 text-xs font-semibold mb-8">סיאט • פולקסווגן • אאודי • סקודה</p>
            <div class="grid grid-cols-3 gap-2 max-w-sm mx-auto relative z-30">
                <a href="tel:086277195" class="btn-action"><i class="fas fa-phone"></i>חיוג</a>
                <a href="https://waze.com/ul?q=פנחס החוצב 35 באר שבע" class="btn-action"><i class="fab fa-waze text-blue-500"></i>ניווט</a>
                <a href="https://wa.me/972505858750" class="btn-action"><i class="fab fa-whatsapp text-green-500"></i>הודעה</a>
            </div>
        </section>

        <div class="floating-container max-w-md mx-auto px-4">
            <div id="authButtons" class="grid grid-cols-2 gap-3 mb-6">
                <button onclick="showPage('loginPage')" class="card p-5 text-center border-b-4 border-blue-600">
                    <i class="fas fa-user-circle text-2xl text-blue-900 mb-2"></i>
                    <p class="font-bold text-xs">כניסה ללקוח</p>
                </button>
                <button onclick="showPage('registerPage')" class="card p-5 text-center border-b-4 border-slate-800">
                    <i class="fas fa-car text-2xl text-slate-800 mb-2"></i>
                    <p class="font-bold text-xs">פתיחת כרטיס</p>
                </button>
            </div>

            <div class="grid grid-cols-2 gap-3 mb-8">
                <div class="service-box"><i class="fas fa-microchip"></i><p class="text-[11px] font-black">דיאגנוסטיקה</p></div>
                <div class="service-box"><i class="fas fa-oil-can"></i><p class="text-[11px] font-black">טיפול תקופתי</p></div>
                <div class="service-box"><i class="fas fa-gears"></i><p class="text-[11px] font-black">שיפוץ גירים</p></div>
                <div class="service-box"><i class="fas fa-snowflake"></i><p class="text-[11px] font-black">מיזוג אוויר</p></div>
            </div>

            <div class="card p-5 mb-8 border-r-4 border-blue-600">
                <div class="flex items-center gap-2 mb-3">
                    <div class="bg-blue-600 w-8 h-8 rounded-full flex items-center justify-center text-white"><i class="fas fa-wrench text-sm"></i></div>
                    <h3 class="font-bold text-slate-800 text-sm">ייעוץ מומחה VAG בזמן אמת</h3>
                </div>
                <textarea id="aiInput" placeholder="תאר את הבעיה (למשל: רעש בבלימה, נורת EPC, חוסר סחיבה)" rows="2" class="text-sm mb-3 bg-slate-50"></textarea>
                <button onclick="askExpertAI()" id="aiBtn" class="w-full bg-slate-900 text-white p-3 rounded-xl font-bold text-xs shadow-lg">שאל את המומחה</button>
                <div id="aiResponse" class="hidden mt-4 ai-response-box"></div>
            </div>
        </div>

        <section class="reviews-section py-12 px-6">
            <h3 class="text-white text-center font-extrabold text-lg mb-8 uppercase tracking-widest">Google Reviews</h3>
            <div class="max-w-md mx-auto space-y-4">
                <div class="review-card-dark">
                    <div class="flex justify-between mb-3"><div class="text-yellow-400 flex gap-1"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div><i class="fab fa-google opacity-30"></i></div>
                    <p class="text-sm font-medium leading-relaxed italic">"מרכז שירות ברמה הכי גבוהה שיש. יחס אישי ומקצועיות ללא פשרות על רכבי הקבוצה."</p>
                    <p class="text-[10px] font-bold mt-4 text-blue-400">אביהו בן מוחה</p>
                </div>
                <div class="review-card-dark">
                    <div class="flex justify-between mb-3"><div class="text-yellow-400 flex gap-1"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div><i class="fab fa-google opacity-30"></i></div>
                    <p class="text-sm font-medium leading-relaxed italic">"אבחון מהיר ומדויק. חסכו לי המון זמן וכסף לעומת מוסכים אחרים בבאר שבע."</p>
                    <p class="text-[10px] font-bold mt-4 text-blue-400">מורן אטיאס</p>
                </div>
            </div>
        </section>
    </div>

    <div id="registerPage" class="hidden p-5 max-w-md mx-auto">
        <button onclick="showPage('homePage')" class="mb-4 text-blue-900 font-bold"><i class="fas fa-arrow-right"></i> חזרה</button>
        <div class="card p-6">
            <h2 class="text-xl font-bold mb-4">פתיחת כרטיס לקוח</h2>
            <div class="space-y-3">
                <input type="text" id="regFirst" placeholder="שם פרטי">
                <input type="text" id="regLast" placeholder="שם משפחה">
                <input type="tel" id="regPhone" placeholder="טלפון">
                <input type="text" id="regPlate" placeholder="מספר רכב">
                <input type="text" id="regCarModel" placeholder="סוג רכב (למשל: סקודה קודיאק)">
                <button onclick="handleRegister()" class="w-full bg-blue-900 text-white p-4 rounded-xl font-bold">שמור נתונים</button>
            </div>
        </div>
    </div>

    <div id="loginPage" class="hidden p-5 max-w-md mx-auto">
        <button onclick="showPage('homePage')" class="mb-4 text-blue-900 font-bold"><i class="fas fa-arrow-right"></i> חזרה</button>
        <div class="card p-6">
            <h2 class="text-xl font-bold mb-4">כניסה לאזור אישי</h2>
            <input type="text" id="loginLast" placeholder="שם משפחה" class="mb-3">
            <input type="text" id="loginPlate" placeholder="מספר רכב" class="mb-4">
            <button onclick="handleLogin()" class="w-full bg-blue-900 text-white p-4 rounded-xl font-bold">התחבר</button>
        </div>
    </div>

    <div id="clientDashboard" class="hidden p-5 max-w-md mx-auto">
        <div class="card bg-slate-900 text-white p-6 mb-4 relative overflow-hidden">
            <div class="relative z-10">
                <p id="carTitle" class="text-lg font-bold mb-1"></p>
                <p id="carPlateSub" class="text-xs text-blue-400 font-mono"></p>
            </div>
            <i class="fas fa-shield-alt absolute -left-4 -bottom-4 text-white opacity-10 text-6xl"></i>
        </div>
        <button onclick="bookWhatsApp()" class="w-full bg-green-600 text-white p-4 rounded-2xl font-bold mb-6 flex items-center justify-center gap-3">
            <i class="fab fa-whatsapp text-2xl"></i> תאם ביקור במוסך
        </button>
        <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="card p-4 text-center"><p class="text-[10px] text-blue-500 font-bold uppercase">טיפול אחרון</p><b id="lastDate" class="text-xs"></b></div>
            <div class="card p-4 text-center"><p class="text-[10px] text-red-500 font-bold uppercase">טיפול הבא</p><b id="nextDate" class="text-xs"></b></div>
        </div>
        <div class="card p-4 mb-2"><p class="text-[10px] opacity-50 font-bold uppercase mb-1">פירוט עבודות אחרונות:</p><p id="lastWork" class="text-xs font-bold leading-relaxed"></p></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDD7YAdTePRWYjwBbmy3gLRYd_OLDwpTL8",
            authDomain: "baram-vag-45e12.firebaseapp.com",
            projectId: "baram-vag-45e12",
            storageBucket: "baram-vag-45e12.firebasestorage.app",
            messagingSenderId: "761383355945",
            appId: "1:761383355945:web:552554b5a6b9fe5e78be38"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let currentUser = null;

        function showPage(id) {
            ['homePage', 'registerPage', 'loginPage', 'clientDashboard'].forEach(p => document.getElementById(p).classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        async function askExpertAI() {
            const input = document.getElementById('aiInput').value.toLowerCase();
            const resDiv = document.getElementById('aiResponse');
            const btn = document.getElementById('aiBtn');
            if(!input) return;
            
            btn.innerText = "המומחה מנתח...";
            resDiv.classList.remove('hidden');
            resDiv.innerHTML = "<div class='flex items-center gap-2'><i class='fas fa-sync fa-spin'></i> <span>סורק קודי תקלות נפוצים ליצרן...</span></div>";

            setTimeout(() => {
                let title = "<b>אבחון מומחה ברע״מ:</b><br>";
                let answer = "";
                
                if(input.includes("מנורה") || input.includes("נורה") || input.includes("epc")) {
                    answer = "נדלקה נורת התראה? ברכבי VAG זה לרוב מצביע על חיישן תקול או חריגה בערכי הפליטה. <b>ההמלצה שלי:</b> לאפס תקלות זה לא פתרון. יש לבצע סריקה במערכת ODIS מקורית כדי לאתר את קוד התקלה המדויק לפני שמחליפים חלקים סתם.";
                } else if (input.includes("גיר") || input.includes("dsg") || input.includes("רעידות")) {
                    answer = "הגיר ב-VAG (במיוחד ה-DSG7) רגיש מאוד לעומס חום. רעידות בתחילת נסיעה מעידות לרוב על שחיקת מצמדים או צורך בעדכון תוכנה למכטרוניקס. <b>חשוב לדעת:</b> הזנחה עלולה להוביל לנזק יקר למכלול הגיר.";
                } else if (input.includes("שמן") || input.includes("טיפול")) {
                    answer = "טיפול תקופתי הוא לא רק שמן ופילטר. אצלנו בודקים גם חופשים בבוקסות, מצב רפידות ומעדכנים גרסאות מחשב. <b>טיפ מהמומחה:</b> השתמש רק בשמן בתקן 504.00/507.00 כדי לשמור על הטורבו.";
                } else if (input.includes("סחיבה") || input.includes("טורבו") || input.includes("לא נוסע")) {
                    answer = "חוסר סחיבה עשוי לנבוע מבריחת גדישה (בוסט) או חיישן MAF מלוכלך. כדאי לבדוק גם את מערכת ההצתה (כויילים/פלגים) שלרוב גורמת ל'פספוס' בעירה תחת עומס.";
                } else {
                    answer = "נשמע שיש צורך בבדיקה מעמיקה. רכבי הקבוצה דורשים דיוק גרמני. <b>הצעה שלי:</b> בוא אלינו לבדיקה ראשונית ללא התחייבות, נחבר סורק ונראה מה המחשב של הרכב אומר.";
                }
                resDiv.innerHTML = title + answer;
                btn.innerText = "שאלה נוספת";
            }, 2000);
        }

        function handleRegister() {
            const plate = document.getElementById('regPlate').value;
            const data = {
                firstName: document.getElementById('regFirst').value, 
                lastName: document.getElementById('regLast').value,
                phone: document.getElementById('regPhone').value, 
                plate: plate, 
                carModel: document.getElementById('regCarModel').value,
                lastServiceDate: "--", nextServiceDate: "בתיאום", lastServiceWork: "טרם בוצע טיפול במערכת"
            };
            db.collection("customers").doc(plate).set(data).then(() => { alert("הכרטיס נפתח!"); showPage('homePage'); });
        }

        function handleLogin() {
            const plate = document.getElementById('loginPlate').value;
            const lastName = document.getElementById('loginLast').value;
            db.collection("customers").doc(plate).get().then(doc => {
                if (doc.exists && doc.data().lastName === lastName) {
                    currentUser = doc.data();
                    document.getElementById('userGreeting').innerText = "שלום, " + currentUser.firstName;
                    document.getElementById('logoutBtn').classList.remove('hidden');
                    document.getElementById('authButtons').classList.add('hidden');
                    
                    document.getElementById('carTitle').innerText = currentUser.carModel;
                    document.getElementById('carPlateSub').innerText = "רכב מס׳: " + currentUser.plate;
                    document.getElementById('lastDate').innerText = currentUser.lastServiceDate;
                    document.getElementById('nextDate').innerText = currentUser.nextServiceDate;
                    document.getElementById('lastWork').innerText = currentUser.lastServiceWork;
                    showPage('clientDashboard');
                } else { alert("פרטי זיהוי לא נכונים"); }
            });
        }

        function bookWhatsApp() {
            const msg = `שלום, כאן ${currentUser.firstName}, מעוניין לתאם טיפול לרכב ${currentUser.plate}.`;
            window.open(`https://wa.me/972505858750?text=${encodeURIComponent(msg)}`, '_blank');
        }
    </script>
</body>
</html>
