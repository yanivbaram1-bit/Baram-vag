<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¨×›×– ×©×™×¨×•×ª ×‘×¨×¢×´× | VAG Specialist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;800&display=swap');
        body { font-family: 'Assistant', sans-serif; background: #f8fafc; }
        .ltr { direction: ltr; display: inline-block; }
        .vag-blue { background-color: #001e50; }
        .category-card { transition: transform 0.2s; z-index: 20; }
        .category-card:active { transform: scale(0.95); }
        .glass-effect { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .hidden { display: none !important; }
        canvas { border: 1px dashed #cbd5e1; border-radius: 1rem; width: 100%; height: 150px; background: #fff; }
    </style>
</head>
<body class="pb-32">

    <header class="bg-white pt-8 pb-12 text-center shadow-sm">
        <div class="vag-blue text-white inline-block px-8 py-2 rounded-2xl font-black italic text-2xl mb-1 shadow-lg">VAG</div>
        <h1 class="text-3xl font-black text-[#001e50]">××¨×›×– ×©×™×¨×•×ª ×‘×¨×¢×´×</h1>
        <p class="text-gray-400 font-bold tracking-widest text-sm">×‘××¨ ×©×‘×¢</p>
    </header>

    <div class="max-w-md mx-auto px-4 -mt-6">
        <div class="bg-white rounded-2xl p-4 shadow-xl border flex justify-between items-center">
            <div class="text-right">
                <p id="liveDate" class="text-[10px] font-black text-blue-900"></p>
                <p id="liveTime" class="text-lg font-black ltr"></p>
            </div>
            <div class="border-r pr-4 text-left">
                <p class="text-[9px] font-bold text-gray-400">×©×¢×•×ª ×¤×¢×™×œ×•×ª</p>
                <p class="text-xs font-black text-green-600 ltr">08:00 - 17:00</p>
            </div>
        </div>
    </div>

    <section class="mt-8 relative px-4">
        <div class="vag-blue rounded-[2.5rem] pt-8 pb-24 text-center text-white">
            <h2 class="text-xl font-black">××•××—×™ VAG</h2>
            <p class="text-[10px] opacity-70">×¡×™××˜ â€¢ ×¡×§×•×“×” â€¢ ××•×“×™ â€¢ ×¤×•×œ×§×¡×•×•×’×Ÿ</p>
        </div>

        <div class="grid grid-cols-2 gap-3 px-2 -mt-16 max-w-md mx-auto">
            <div class="category-card bg-white p-5 rounded-3xl shadow-lg border text-center">
                <i class="fas fa-tools text-blue-900 text-xl mb-2"></i>
                <p class="text-[11px] font-black">××›×•× ××•×ª ×›×œ×œ×™×ª</p>
            </div>
            <div class="category-card bg-white p-5 rounded-3xl shadow-lg border text-center">
                <i class="fas fa-laptop-medical text-blue-900 text-xl mb-2"></i>
                <p class="text-[11px] font-black">×“×™××’× ×•×¡×˜×™×§×”</p>
            </div>
            <div class="category-card bg-white p-5 rounded-3xl shadow-lg border text-center">
                <i class="fas fa-oil-can text-blue-900 text-xl mb-2"></i>
                <p class="text-[11px] font-black">×˜×™×¤×•×œ ×ª×§×•×¤×ª×™</p>
            </div>
            <div class="category-card bg-white p-5 rounded-3xl shadow-lg border text-center">
                <i class="fas fa-snowflake text-blue-900 text-xl mb-2"></i>
                <p class="text-[11px] font-black">××™×–×•×’ ××•×•×™×¨</p>
            </div>
            <div class="category-card bg-white p-5 rounded-3xl shadow-lg border text-center">
                <i class="fas fa-microchip text-blue-900 text-xl mb-2"></i>
                <p class="text-[11px] font-black">×§×™×“×•×“×™×</p>
            </div>
            <div class="category-card bg-white p-5 rounded-3xl shadow-lg border text-center">
                <i class="fas fa-clipboard-check text-blue-900 text-xl mb-2"></i>
                <p class="text-[11px] font-black">×”×›× ×” ×œ×˜×¡×˜</p>
            </div>
        </div>
    </section>

    <div class="max-w-md mx-auto mt-8 px-6">
        <div class="bg-amber-50 border-r-4 border-amber-400 p-4 rounded-xl flex items-center gap-3">
            <span class="text-xl">ğŸ’¡</span>
            <div>
                <p class="text-[10px] font-bold text-amber-800">×˜×™×¤ ×™×•××™</p>
                <p id="dailyTip" class="text-xs text-amber-700 font-semibold"></p>
            </div>
        </div>
    </div>

    <div class="max-w-md mx-auto mt-6 px-6">
        <div class="bg-white rounded-[2rem] p-6 shadow-sm border border-blue-50 relative overflow-hidden">
            <div class="flex items-center gap-2 mb-4">
                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold">G</div>
                <h4 class="font-black text-sm text-slate-800">××•××—×” AI Gemini (VAG)</h4>
            </div>
            <input id="aiInput" type="text" placeholder="×©××œ×• ×¢×œ ×ª×§×œ×” ××• × ×•×¨×” ×‘×œ×•×— ×”××—×•×•× ×™×..." class="w-full bg-slate-50 p-3 rounded-xl text-xs border-none outline-none focus:ring-1 ring-blue-900">
            <button onclick="askAI()" class="w-full mt-2 bg-blue-900 text-white p-3 rounded-xl text-xs font-black">×©××œ ××ª ×”××•××—×”</button>
            <p id="aiResponse" class="mt-4 text-[11px] text-slate-600 bg-blue-50/50 p-3 rounded-xl hidden leading-relaxed"></p>
        </div>
    </div>

    <div class="mt-12 vag-blue py-10 px-6">
        <h3 class="text-white text-center font-black mb-6">×‘×™×§×•×¨×•×ª Google (5â˜…)</h3>
        <div class="flex gap-4 overflow-x-auto pb-4 ltr">
            <div class="min-w-[260px] bg-white/10 p-4 rounded-2xl border border-white/20 text-white rtl text-right">
                <div class="flex text-yellow-400 text-[8px] mb-2"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                <p class="text-[11px] italic">"×”××•×¡×š ×”×›×™ ××§×¦×•×¢×™ ×‘×‘××¨ ×©×‘×¢ ×œ×¨×›×‘×™ ×¤×•×œ×§×¡×•×•×’×Ÿ. ×©×™×¨×•×ª ××“×”×™×!"</p>
                <p class="mt-2 text-[9px] font-bold opacity-50">- ××‘×™×‘ ×œ×•×™</p>
            </div>
            </div>
    </div>

    <div class="fixed bottom-0 left-0 right-0 p-4 bg-white/80 backdrop-blur-md border-t z-[100] grid grid-cols-2 gap-2 max-w-md mx-auto">
        <button onclick="openModal('loginModal')" class="bg-blue-900 text-white p-4 rounded-2xl font-black text-sm">×›× ×™×¡×” ×œ××–×•×¨ ××™×©×™</button>
        <button onclick="openModal('regModal')" class="bg-white border-2 border-blue-900 text-blue-900 p-4 rounded-2xl font-black text-sm">×”×¨×©××” ××”×™×¨×”</button>
        <a href="tel:086277195" class="bg-green-600 text-white p-3 rounded-xl text-center font-black text-xs col-span-1"><i class="fas fa-phone-alt ml-1"></i> ×—×™×•×’</a>
        <a href="https://waze.com/ul?q=×¤× ×—×¡ ×”×—×•×¦×‘ 35 ×‘××¨ ×©×‘×¢" target="_blank" class="bg-blue-500 text-white p-3 rounded-xl text-center font-black text-xs col-span-1"><i class="fas fa-location-arrow ml-1"></i> × ×™×•×•×˜</a>
    </div>

    <div id="personalArea" class="hidden fixed inset-0 bg-slate-50 z-[200] overflow-y-auto pb-32">
        <nav class="bg-white p-6 border-b flex justify-between items-center sticky top-0 z-50">
            <div>
                <h2 id="uWelcome" class="font-black text-blue-900 italic">×©×œ×•×, ×œ×§×•×—</h2>
                <p id="uCarHeader" class="text-[10px] font-bold text-gray-400 ltr"></p>
            </div>
            <button onclick="logout()" class="text-red-500 font-bold"><i class="fas fa-sign-out-alt"></i></button>
        </nav>

        <div class="p-6 space-y-6 max-w-md mx-auto">
            <div id="smartAlert" class="hidden bg-blue-900 text-white p-4 rounded-2xl shadow-lg flex items-center gap-3 animate-pulse">
                <i class="fas fa-bell text-yellow-400"></i>
                <p id="alertText" class="text-[11px] font-bold"></p>
            </div>

            <div id="quoteSection" class="hidden bg-white rounded-3xl p-6 shadow-xl border-2 border-amber-200">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="font-black text-amber-600">×”×¦×¢×ª ××—×™×¨ ×œ××™×©×•×¨</h4>
                    <button onclick="downloadQuote()" class="text-blue-600 text-xs font-bold"><i class="fas fa-download ml-1"></i> ×”×•×¨×“×”</button>
                </div>
                <div id="quotePDFContent" class="bg-slate-50 p-4 rounded-2xl text-[10px] space-y-4 mb-4 border">
                    <div class="text-center border-b pb-2 mb-2">
                        <p class="font-black text-blue-900 text-sm">××¨×›×– ×©×™×¨×•×ª ×‘×¨×¢×´×</p>
                        <p class="text-[8px]">×¤× ×—×¡ ×”×—×•×¦×‘ 35, ×‘××¨ ×©×‘×¢ | 08-6277195</p>
                    </div>
                    <div id="quoteItems"></div>
                    <div class="border-t pt-2 font-black text-blue-900 flex justify-between text-xs">
                        <span>×¡×”"×› ×œ×ª×©×œ×•× (×›×•×œ×œ ××¢"×):</span>
                        <span id="quoteTotal" class="ltr"></span>
                    </div>
                </div>
                <p class="text-[9px] text-gray-400 mb-2 font-bold text-center italic">×™×© ×œ×—×ª×•× ×‘×ª×•×š ×”××¡×’×¨×ª ×œ××™×©×•×¨ ×”×¢×‘×•×“×”</p>
                <canvas id="sigCanvas"></canvas>
                <div class="grid grid-cols-2 gap-2 mt-4">
                    <button onclick="sigPad.clear()" class="bg-gray-100 p-3 rounded-xl text-xs font-bold">× ×§×” ×—×ª×™××”</button>
                    <button onclick="approveQuote()" class="bg-green-600 text-white p-3 rounded-xl text-xs font-black shadow-lg">××©×¨ ×•×—×ª×•×</button>
                </div>
            </div>

            <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100">
                <h4 class="font-black text-sm mb-4"><i class="fas fa-calendar-alt ml-2 text-blue-900"></i>×§×‘×™×¢×ª ×ª×•×¨ ×œ××•×¡×š</h4>
                <div class="space-y-3">
                    <input id="appDate" type="date" class="w-full p-4 bg-slate-50 rounded-2xl text-xs border-none outline-none ltr">
                    <select id="appTime" class="w-full p-4 bg-slate-50 rounded-2xl text-xs border-none outline-none ltr font-bold">
                        <option value="08:00">08:00</option>
                        <option value="09:00">09:00</option>
                        <option value="10:00">10:00</option>
                        <option value="11:00">11:00</option>
                        <option value="12:00">12:00</option>
                        <option value="13:00">13:00</option>
                        <option value="14:00">14:00</option>
                        <option value="15:00">15:00</option>
                    </select>
                    <button onclick="bookAppointment()" class="w-full bg-blue-900 text-white p-4 rounded-2xl font-black text-xs">×©×œ×— ×‘×§×©×ª ×ª×•×¨</button>
                </div>
                <div id="myAppointments" class="mt-4 space-y-2"></div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div class="bg-white p-4 rounded-2xl shadow-sm border text-center">
                    <p class="text-[9px] text-gray-400 font-bold mb-1">×˜×¡×˜ ×”×‘×</p>
                    <p id="uNextTest" class="text-xs font-black text-blue-900 ltr">--/--/--</p>
                </div>
                <div class="bg-white p-4 rounded-2xl shadow-sm border text-center">
                    <p class="text-[9px] text-gray-400 font-bold mb-1">×˜×™×¤×•×œ ×”×‘×</p>
                    <p id="uNextService" class="text-xs font-black text-blue-900 ltr">--/--/--</p>
                </div>
            </div>
            
            <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100">
                <h4 class="font-black text-sm mb-4">×”×•×“×¢×•×ª ××”×¦×•×•×ª</h4>
                <div id="msgContainer" class="space-y-3 text-[11px] text-gray-500 italic">××™×Ÿ ×”×•×“×¢×•×ª ×—×“×©×•×ª.</div>
            </div>
        </div>
    </div>

    <script>
        // 1. INIT & CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyDD7YAdTePRWYjwBbmy3gLRYd_OLDwpTL8",
            authDomain: "baram-vag-45e12.firebaseapp.com",
            projectId: "baram-vag-45e12",
            storageBucket: "baram-vag-45e12.firebasestorage.app",
            messagingSenderId: "761383355945",
            appId: "1:761383355945:web:552554b5a6b9fe5e78be38"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 2. LIVE DATE/TIME & TIP
        function updateLiveUI() {
            const now = new Date();
            document.getElementById('liveDate').innerText = now.toLocaleDateString('he-IL', {weekday:'long', day:'numeric', month:'numeric'});
            document.getElementById('liveTime').innerText = now.toLocaleTimeString('he-IL', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
        }
        setInterval(updateLiveUI, 1000);
        updateLiveUI();

        const tips = ["×‘×“×™×§×ª ×©××Ÿ ×¤×¢× ×‘×©×‘×•×¢×™×™× ×©×•××¨×ª ×¢×œ ×”-DSG ×©×œ×›×.", "× ×•×¨×ª EPC? ×’×©×• ××™×“ ×œ×‘×“×™×§×ª ××—×©×‘.", "×”×—×œ×™×¤×• ××’×‘×™× ×‘×ª×—×™×œ×ª ×›×œ ×—×•×¨×£ ×œ× ×¡×™×¢×” ×‘×˜×•×—×”."];
        document.getElementById('dailyTip').innerText = tips[new Date().getDate() % tips.length];

        // 3. AI EXPERT (GEMINI)
        function askAI() {
            const q = document.getElementById('aiInput').value.toLowerCase();
            const res = document.getElementById('aiResponse');
            res.classList.remove('hidden');
            if(q.includes('vag') || q.includes('×¤×•×œ×§×¡') || q.includes('××•×“×™') || q.includes('×¡×™××˜') || q.includes('×¡×§×•×“×”')) {
                res.innerText = "×©×œ×•×, ×× ×™ Gemini. ×›×™×•×•×Ÿ ×©×©××œ×ª ×¢×œ ×¨×›×‘ ××§×‘×•×¦×ª VAG, ×—×©×•×‘ ×œ×“×¢×ª ×©×ª×§×œ×•×ª ×›××œ×• ×“×•×¨×©×•×ª ×¡×•×¨×§ ×ª×§×œ×•×ª ××§×•×¨×™ (Odis). ×× ×—× ×• ×‘××¨×›×– ×©×™×¨×•×ª ×‘×¨×¢×´× ××•××—×™× ×‘×“×™×•×§ ×‘×–×”.";
            } else {
                res.innerText = "××¦×˜×¢×¨, ×× ×™ ××•×¡××š ×œ×¢× ×•×ª ×¨×§ ×¢×œ ×©××œ×•×ª ×”×§×©×•×¨×•×ª ×œ××•×ª×’×™ ×§×‘×•×¦×ª VAG.";
            }
        }

        // 4. SMART ALERTS (Winter/Summer)
        function setSmartAlerts(userData) {
            const banner = document.getElementById('smartAlert');
            const txt = document.getElementById('alertText');
            const month = new Date().getMonth() + 1;

            if(month >= 11 || month <= 2) {
                banner.classList.remove('hidden');
                txt.innerText = "×”×—×•×¨×£ ×›××Ÿ! ×‘×•× ×œ×‘×“×™×§×ª ×—×•×¨×£ ×—×™× × ×•×œ×•×•×“× ×©×”×¨×›×‘ ××•×›×Ÿ ×œ×’×©×.";
            } else if(month >= 6 && month <= 8) {
                banner.classList.remove('hidden');
                txt.innerText = "×§×™×¥ ×‘×‘××¨ ×©×‘×¢! ××•××œ×¥ ×œ×‘×“×•×§ ××ª ×™×¢×™×œ×•×ª ×”××–×’×Ÿ ×œ×¤× ×™ ×©×™× ×”×—×•×.";
            }
        }

        // 5. SIGNATURE & QUOTE
        let sigPad;
        function initQuoteSystem(user) {
            const pending = user.quotes ? user.quotes.find(q => !q.signed) : null;
            if(pending) {
                document.getElementById('quoteSection').classList.remove('hidden');
                document.getElementById('quoteTotal').innerText = pending.totalFinal;
                
                let html = '<p class="font-bold border-b mb-1">×¤×™×¨×•×˜ ×¢×‘×•×“×”:</p>';
                pending.work.forEach(w => html += `<div class="flex justify-between"><span>${w.desc}</span><span class="ltr">â‚ª${w.price}</span></div>`);
                html += '<p class="font-bold border-b mt-3 mb-1">×¤×™×¨×•×˜ ×—×œ×¤×™×:</p>';
                pending.parts.forEach(p => html += `<div class="flex justify-between"><span>${p.desc}</span><span class="ltr">â‚ª${p.price}</span></div>`);
                
                document.getElementById('quoteItems').innerHTML = html;
                window.activeQuoteId = pending.id;

                const canvas = document.getElementById('sigCanvas');
                sigPad = new SignaturePad(canvas);
            }
        }

        async function approveQuote() {
            if(sigPad.isEmpty()) return alert("×—×•×‘×” ×œ×—×ª×•× ×œ××™×©×•×¨!");
            const plate = localStorage.getItem('userPlate');
            const doc = await db.collection("customers").doc(plate).get();
            const quotes = doc.data().quotes;
            const idx = quotes.findIndex(q => q.id === window.activeQuoteId);
            
            quotes[idx].signed = true;
            quotes[idx].signature = sigPad.toDataURL();
            
            await db.collection("customers").doc(plate).update({ quotes });
            alert("×”×”×¦×¢×” ××•×©×¨×” ×•× ×©×œ×—×” ×œ× ×™×”×•×œ!");
            location.reload();
        }

        function downloadQuote() {
            const element = document.getElementById('quotePDFContent');
            html2pdf().from(element).save('×”×¦×¢×ª_××—×™×¨_×‘×¨×¢×.pdf');
        }

        // 6. LOGIN/LOGOUT & APPOINTMENTS
        async function handleLogin() {
            const id = document.getElementById('lID').value;
            const plate = document.getElementById('lPlate').value;
            const doc = await db.collection("customers").doc(plate).get();
            if(doc.exists && doc.data().id === id) {
                localStorage.setItem('userPlate', plate);
                showUserArea(doc.data());
            } else alert("×¤×¨×˜×™× ×©×’×•×™×™×");
        }

        function showUserArea(user) {
            document.getElementById('personalArea').classList.remove('hidden');
            document.getElementById('uWelcome').innerText = `×©×œ×•×, ${user.fName}`;
            document.getElementById('uCarHeader').innerText = `${user.model} | ${user.plate}`;
            document.getElementById('uNextTest').innerText = user.nextT || "--/--/--";
            document.getElementById('uNextService').innerText = user.nextS || "--/--/--";
            setSmartAlerts(user);
            initQuoteSystem(user);
            loadAppts(user.plate);
        }

        function loadAppts(plate) {
            db.collection("appointments").where("plate", "==", plate).onSnapshot(s => {
                const cont = document.getElementById('myAppointments');
                cont.innerHTML = "";
                s.forEach(doc => {
                    const a = doc.data();
                    cont.innerHTML += `<div class="bg-slate-50 p-3 rounded-xl flex justify-between text-[11px] border">
                        <span class="ltr font-black">${a.date} | ${a.time}</span>
                        <button onclick="cancelAppt('${doc.id}')" class="text-red-500 font-bold">×‘×™×˜×•×œ</button>
                    </div>`;
                });
            });
        }

        async function bookAppointment() {
            const plate = localStorage.getItem('userPlate');
            const date = document.getElementById('appDate').value;
            const time = document.getElementById('appTime').value;
            if(!date) return alert("×‘×—×¨ ×ª××¨×™×š");
            await db.collection("appointments").add({ plate, date, time, status: "×××ª×™×Ÿ" });
            alert("×”×‘×§×©×” × ×©×œ×—×”!");
        }

        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function logout() { localStorage.clear(); location.reload(); }
    </script>
</body>
</html>
