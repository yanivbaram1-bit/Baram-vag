<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מרכז שירות ברע״מ | VAG Specialist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;800&display=swap');
        body { font-family: 'Assistant', sans-serif; background: #f4f7f9; scroll-behavior: smooth; }
        .ltr { direction: ltr; display: inline-block; }
        .vag-blue { background-color: #001e50; }
        .category-grid { position: relative; z-index: 10; margin-top: -40px; }
        .review-scroll { overflow-x: auto; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; }
        .review-card { scroll-snap-align: start; flex: 0 0 85%; }
        .hidden { display: none !important; }
        .grid-btn { transition: transform 0.1s; cursor: pointer; }
        .grid-btn:active { transform: scale(0.95); }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="pb-24">

    <header class="bg-white pt-12 pb-16 text-center border-b shadow-sm">
        <h1 class="text-4xl font-black text-[#001e50] tracking-tight">מרכז שירות ברע״מ</h1>
    </header>

    <div class="max-w-md mx-auto px-4 -mt-8">
        <div class="bg-white rounded-2xl p-4 shadow-xl flex justify-between items-center border border-gray-100">
            <div class="text-right">
                <p id="liveDate" class="text-xs font-black text-gray-800"></p>
                <p id="liveTime" class="text-lg font-black text-blue-900 ltr"></p>
            </div>
            <div class="text-left border-r pr-4">
                <p class="text-[10px] font-bold text-gray-400 uppercase">סטטוס מוסך</p>
                <p id="garageStatus" class="text-xs font-black text-green-600 ltr">בדיקה...</p>
            </div>
        </div>
    </div>

    <section class="mt-10 px-4">
        <div class="vag-blue rounded-[2.5rem] pt-10 pb-24 text-center text-white shadow-inner">
            <h2 class="text-2xl font-black mb-1">מומחים לקבוצת VAG</h2>
            <p class="text-sm opacity-80 font-light italic">סיאט • סקודה • אודי • פולקסווגן</p>
        </div>

        <div class="max-w-md mx-auto grid grid-cols-2 gap-4 px-4 category-grid">
            <div onclick="openService('מכונאות', 'טיפול מקיף במנוע, מערכות קירור והעברת כוח בסטנדרט יצרן.')" class="grid-btn bg-white p-6 rounded-3xl shadow-md text-center border border-blue-50">
                <i class="fas fa-tools text-2xl text-blue-900 mb-2"></i>
                <p class="text-xs font-black">מכונאות</p>
            </div>
            <div onclick="openService('דיאגנוסטיקה', 'סריקת תקלות ממוחשבת בטכנולוגיית ODIS המקורית של הקבוצה.')" class="grid-btn bg-white p-6 rounded-3xl shadow-md text-center border border-blue-50">
                <i class="fas fa-microchip text-2xl text-blue-900 mb-2"></i>
                <p class="text-xs font-black">דיאגנוסטיקה</p>
            </div>
            <div onclick="openService('טיפולים', 'ביצוע טיפול תקופתי הכולל שמן ומסננים מקוריים לשמירה על המנוע.')" class="grid-btn bg-white p-6 rounded-3xl shadow-md text-center border border-blue-50">
                <i class="fas fa-oil-can text-2xl text-blue-900 mb-2"></i>
                <p class="text-xs font-black">טיפולים</p>
            </div>
            <div onclick="openService('מיזוג אוויר', 'מילוי גז, בדיקת וואקום וניקוי אנטי-בקטריאלי למערכת המיזוג.')" class="grid-btn bg-white p-6 rounded-3xl shadow-md text-center border border-blue-50">
                <i class="fas fa-snowflake text-2xl text-blue-900 mb-2"></i>
                <p class="text-xs font-black">מיזוג אוויר</p>
            </div>
            <div onclick="openService('חשמל רכב', 'אבחון ותיקון צמות חשמל, מצברים, אלטרנטורים ומערכות נוחות.')" class="grid-btn bg-white p-6 rounded-3xl shadow-md text-center border border-blue-50">
                <i class="fas fa-car-battery text-2xl text-blue-900 mb-2"></i>
                <p class="text-xs font-black">חשמל רכב</p>
            </div>
            <div onclick="openService('הכנה לטסט', 'בדיקה בטיחותית של בלמים, הגה ותאורה לפני מבחן הרישוי.')" class="grid-btn bg-white p-6 rounded-3xl shadow-md text-center border border-blue-50">
                <i class="fas fa-file-invoice text-2xl text-blue-900 mb-2"></i>
                <p class="text-xs font-black">הכנה לטסט</p>
            </div>
        </div>
    </section>

    <div class="max-w-md mx-auto mt-8 px-6">
        <div class="bg-white rounded-3xl p-6 shadow-sm border border-blue-100 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-1 h-full bg-blue-600"></div>
            <div class="flex items-center gap-3 mb-4">
                <img src="https://www.gstatic.com/lamda/images/gemini_sparkle_v002_d47353046547a09c0179.svg" class="w-5 h-5">
                <h4 class="font-black text-sm text-blue-900">מומחה VAG וירטואלי</h4>
            </div>
            <textarea id="aiInput" rows="2" placeholder="יש לך נורה דולקת? שאלה על הגיר? שאל אותי..." class="w-full bg-gray-50 p-3 rounded-xl text-xs outline-none border focus:border-blue-400 resize-none"></textarea>
            <button id="askAiBtn" class="w-full mt-2 bg-blue-900 text-white p-3 rounded-xl text-xs font-bold shadow-md active:scale-95 transition-transform">שלח שאלה</button>
            <div id="aiLoading" class="hidden mt-3 text-center text-[10px] font-bold"><i class="fas fa-circle-notch fa-spin text-blue-500"></i> Gemini מנתח את התקלה...</div>
            <p id="aiResponse" class="mt-4 text-[11px] text-gray-700 leading-relaxed bg-blue-50 p-3 rounded-xl hidden border border-blue-100 shadow-sm"></p>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-4 px-6 mt-10 max-w-md mx-auto">
        <button onclick="openModal('loginModal')" class="bg-blue-900 text-white p-4 rounded-2xl font-black shadow-lg">כניסה</button>
        <button onclick="openModal('regModal')" class="bg-white border-2 border-blue-900 text-blue-900 p-4 rounded-2xl font-black">הרשמה</button>
    </div>

    <section class="mt-12 vag-blue py-10 overflow-hidden">
        <h3 class="text-white font-black text-center mb-6 italic">לקוחותינו מספרים</h3>
        <div id="reviewContainer" class="flex gap-4 review-scroll px-6 pb-4"></div>
    </section>

    <div class="fixed bottom-6 left-0 right-0 px-6 flex gap-3 z-[100] max-w-md mx-auto">
        <a href="tel:086277195" class="flex-1 bg-green-500 text-white p-4 rounded-2xl text-center shadow-2xl font-black flex items-center justify-center gap-2">
            <i class="fas fa-phone-alt"></i>חיוג למוסך
        </a>
        <a href="https://waze.com/ul?q=פנחס החוצב 35 באר שבע" target="_blank" class="flex-1 bg-blue-600 text-white p-4 rounded-2xl text-center shadow-2xl font-black flex items-center justify-center gap-2">
            <i class="fas fa-location-arrow"></i>WAZE
        </a>
    </div>

    <div id="serviceModal" class="hidden fixed inset-0 bg-black/80 z-[500] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-3xl p-8 text-center shadow-2xl">
            <h2 id="serviceTitle" class="text-2xl font-black text-blue-900 mb-2"></h2>
            <p id="serviceDesc" class="text-sm text-gray-600 mb-6"></p>
            <button onclick="closeModal('serviceModal'); openModal('loginModal');" class="w-full bg-blue-900 text-white p-4 rounded-2xl font-black mb-2 shadow-md">תיאום תור לשירות</button>
            <button onclick="closeModal('serviceModal')" class="text-gray-400 text-xs font-bold pt-2">חזרה</button>
        </div>
    </div>

    <div id="loginModal" class="hidden fixed inset-0 bg-black/90 z-[500] flex items-center justify-center p-6 backdrop-blur-md">
        <div class="bg-white w-full max-w-sm rounded-[2.5rem] p-8 text-center shadow-2xl">
            <h2 class="text-2xl font-black text-blue-900 mb-6">כניסת לקוח</h2>
            <input id="lID" type="number" placeholder="תעודת זהות" class="w-full p-4 bg-gray-50 rounded-2xl mb-3 ltr text-center font-bold border outline-none">
            <input id="lPlate" type="number" placeholder="מספר רכב" class="w-full p-4 bg-gray-50 rounded-2xl mb-6 ltr text-center font-bold border outline-none">
            <button onclick="handleLogin()" class="w-full bg-blue-900 text-white p-5 rounded-2xl font-black shadow-lg">כניסה</button>
            <button onclick="closeModal('loginModal')" class="mt-4 text-gray-400 text-xs">סגור</button>
        </div>
    </div>

    <div id="regModal" class="hidden fixed inset-0 bg-black/90 z-[500] flex items-center justify-center p-4 backdrop-blur-md">
        <div class="bg-white w-full max-w-md rounded-[2.5rem] p-8 max-h-[90vh] overflow-y-auto shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-black text-blue-900">פתיחת כרטיס לקוח</h2>
                <button onclick="closeModal('regModal')" class="text-gray-300"><i class="fas fa-times"></i></button>
            </div>
            <div class="space-y-3">
                <input id="rFName" type="text" placeholder="שם מלא" class="w-full p-4 bg-gray-50 rounded-2xl border outline-none">
                <input id="rID" type="number" placeholder="תעודת זהות" class="w-full p-4 bg-gray-50 rounded-2xl border ltr outline-none">
                <input id="rPhone" type="tel" placeholder="טלפון" class="w-full p-4 bg-gray-50 rounded-2xl border ltr outline-none">
                <input id="rModel" type="text" placeholder="דגם רכב" class="w-full p-4 bg-gray-50 rounded-2xl border outline-none">
                <input id="rPlate" type="number" placeholder="מספר רכב" class="w-full p-4 bg-blue-50 border-blue-200 rounded-2xl border ltr font-black outline-none">
                <button onclick="handleRegister()" class="w-full bg-blue-900 text-white p-5 rounded-2xl font-black shadow-lg">הרשמה וסיום</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        // המפתח שלך מה-API Studio
        const GEMINI_API_KEY = "AIzaSyDD7YAdTePRWYjwBbmy3gLRYd_OLDwpTL8";

        async function runAi() {
            const input = document.getElementById('aiInput');
            const resBox = document.getElementById('aiResponse');
            const load = document.getElementById('aiLoading');
            
            if(!input.value) return;

            load.classList.remove('hidden');
            resBox.classList.add('hidden');

            try {
                const genAI = new GoogleGenerativeAI(GEMINI_API_KEY);
                const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                const prompt = `אתה המומחה הטכני הווירטואלי של 'מרכז שירות ברע״מ' בבאר שבע. המוסך מתמחה ברכבי VAG (אאודי, סיאט, סקודה, פולקסווגן). ענה ללקוח בעברית קצרה, מקצועית ואדיבה על השאלה: ${input.value}. בסוף התשובה, תמיד תמליץ לקבוע תור לבדיקה מקצועית במוסך.`;
                
                const result = await model.generateContent(prompt);
                const response = await result.response;
                resBox.innerText = response.text();
            } catch (e) {
                resBox.innerText = "כרגע יש עומס על מערכת ה-AI. ניתן לפנות אלינו טלפונית לתיאום בדיקה!";
            } finally {
                load.classList.add('hidden');
                resBox.classList.remove('hidden');
            }
        }
        document.getElementById('askAiBtn').addEventListener('click', runAi);

        // Reviews Data
        const reviews = [
            {n: "יניב ל.", t: "מקצועיות ברמה הגבוהה ביותר. פתרו לי בעיה בגיר DSG שאף מוסך לא זיהה."},
            {n: "מיטל כ.", t: "שירות אדיב ושקיפות מלאה. הרגשתי שהרכב שלי בידיים טובות."},
            {n: "אלעד ב.", t: "הגעתי לטיפול 15,000, יצאתי תוך פחות משעתיים. מהיר ומקצועי."},
            {n: "קובי ש.", t: "המומחים מספר 1 בדרום ל-VAG. אמינות ויושרה זה שם המשחק כאן."},
            {n: "אלונה מ.", t: "מוסך נקי ומסודר, הצוות מסביר הכל בסבלנות. ממליצה בחום."},
            {n: "מאור ג.", t: "דיאגנוסטיקה מדויקת. חסכו לי אלפי שקלים על תיקון מיותר."},
            {n: "דוד א.", t: "שירות מעולה! יחס אישי ומחיר הוגן מאוד לטיפול תקופתי."},
            {n: "שירן ח.", t: "הגעתי עם נורת EPC דולקת, הבעיה נפתרה מהר ובמקצועיות."},
            {n: "יוסי פ.", t: "מרכז שירות ברמה של יצרן. רק אצל ברע״מ אני מטפל באאודי שלי."},
            {n: "איתי ד.", t: "תודה ליניב ולצוות על הטיפול המסור. אין עליכם!"}
        ];
        const rc = document.getElementById('reviewContainer');
        reviews.forEach(r => {
            rc.innerHTML += `<div class="review-card bg-white/10 p-5 rounded-3xl border border-white/20 text-white">
                <div class="flex text-yellow-400 text-[10px] mb-2"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                <p class="text-xs italic font-light">"${r.t}"</p>
                <p class="mt-3 text-[10px] font-bold opacity-60">- ${r.n}</p>
            </div>`;
        });
    </script>

    <script>
        // Firebase & Logic
        const firebaseConfig = {
            apiKey: "AIzaSyDD7YAdTePRWYjwBbmy3gLRYd_OLDwpTL8",
            authDomain: "baram-vag-45e12.firebaseapp.com",
            projectId: "baram-vag-45e12",
            storageBucket: "baram-vag-45e12.firebasestorage.app",
            messagingSenderId: "761383355945",
            appId: "1:761383355945:web:552554b5a6b9fe5e78be38"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        window.openService = (title, desc) => {
            document.getElementById('serviceTitle').innerText = title;
            document.getElementById('serviceDesc').innerText = desc;
            openModal('serviceModal');
        };

        window.handleLogin = async () => {
            const id = document.getElementById('lID').value;
            const plate = document.getElementById('lPlate').value;
            const doc = await db.collection("customers").doc(plate).get();
            if(doc.exists && doc.data().id === id) {
                alert("ברוך הבא למרכז שירות ברע״מ!");
                location.reload(); 
            } else { alert("פרטי זיהוי שגויים"); }
        };

        window.handleRegister = async () => {
            const plate = document.getElementById('rPlate').value;
            const data = {
                fName: document.getElementById('rFName').value,
                id: document.getElementById('rID').value,
                plate: plate, model: document.getElementById('rModel').value,
                regDate: new Date()
            };
            await db.collection("customers").doc(plate).set(data);
            alert("הרישום בוצע בהצלחה!"); 
            closeModal('regModal');
        };

        window.openModal = id => document.getElementById(id).classList.remove('hidden');
        window.closeModal = id => document.getElementById(id).classList.add('hidden');

        // Clock & Garage Logic
        setInterval(() => {
            const now = new Date();
            document.getElementById('liveDate').innerText = now.toLocaleDateString('he-IL', {weekday:'long', day:'numeric'});
            document.getElementById('liveTime').innerText = now.toLocaleTimeString('he-IL', {hour:'2-digit', minute:'2-digit'});
            const h = now.getHours();
            const s = document.getElementById('garageStatus');
            if(h >= 8 && h < 17 && now.getDay() < 5) {
                s.innerText = "פתוח עכשיו"; s.className = "text-xs font-black text-green-600";
            } else {
                s.innerText = "סגור כעת"; s.className = "text-xs font-black text-red-500";
            }
        }, 1000);
    </script>
</body>
</html>
