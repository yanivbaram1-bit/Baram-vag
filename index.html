<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¨×›×– ×©×™×¨×•×ª ×‘×¨×¢×´× | VAG Expert</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;800&display=swap');
        body { font-family: 'Assistant', sans-serif; background: #f4f7f9; }
        .ltr { direction: ltr; display: inline-block; }
        .vag-blue { background-color: #001e50; }
        .category-grid { position: relative; z-index: 20; margin-top: -60px; }
        .tab-btn.active { border-bottom: 3px solid #001e50; color: #001e50; font-weight: 800; }
        .hidden { display: none !important; }
        canvas { border: 1px dashed #cbd5e1; border-radius: 12px; width: 100%; height: 120px; background: white; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-32">

    <header class="bg-white pt-8 pb-16 text-center shadow-sm">
        <h1 class="text-3xl font-black text-[#001e50]">××¨×›×– ×©×™×¨×•×ª ×‘×¨×¢×´×</h1>
        <p class="text-gray-400 font-bold text-xs tracking-widest mt-1 uppercase">×‘××¨ ×©×‘×¢</p>
    </header>

    <div class="max-w-md mx-auto px-4 -mt-10">
        <div class="bg-white rounded-3xl p-5 shadow-xl border flex justify-between items-center">
            <div class="text-right">
                <p id="liveDate" class="text-[10px] font-black text-blue-900"></p>
                <p id="liveTime" class="text-xl font-black ltr"></p>
            </div>
            <div class="border-r pr-4 text-left">
                <p class="text-[9px] text-gray-400 font-bold uppercase">×©×¢×•×ª ×¤×¢×™×œ×•×ª</p>
                <p class="text-xs font-black text-[#001e50] ltr">07:30 - 15:30</p>
                <p class="text-[9px] text-red-500 font-bold">×©×™×©×™-×©×‘×ª: ×¡×’×•×¨</p>
            </div>
        </div>
    </div>

    <section class="mt-8 relative px-4">
        <div class="vag-blue rounded-[2.5rem] pt-12 pb-24 text-center text-white shadow-inner">
            <h2 class="text-2xl font-black italic mb-1">××•××—×™ VAG</h2>
            <p class="text-xs opacity-70">×¡×™××˜ â€¢ ×¡×§×•×“×” â€¢ ××•×“×™ â€¢ ×¤×•×œ×§×¡×•×•×’×Ÿ</p>
        </div>

        <div class="max-w-md mx-auto grid grid-cols-2 gap-3 px-2 category-grid">
            <div class="bg-white p-6 rounded-3xl shadow-lg border border-blue-50 text-center hover:scale-105 transition">
                <i class="fas fa-tools text-2xl text-[#001e50] mb-3"></i>
                <p class="text-xs font-black">××›×•× ××•×ª</p>
            </div>
            <div class="bg-white p-6 rounded-3xl shadow-lg border border-blue-50 text-center hover:scale-105 transition">
                <i class="fas fa-microchip text-2xl text-[#001e50] mb-3"></i>
                <p class="text-xs font-black">×“×™××’× ×•×¡×˜×™×§×”</p>
            </div>
            <div class="bg-white p-6 rounded-3xl shadow-lg border border-blue-50 text-center hover:scale-105 transition">
                <i class="fas fa-oil-can text-2xl text-[#001e50] mb-3"></i>
                <p class="text-xs font-black">×˜×™×¤×•×œ×™×</p>
            </div>
            <div class="bg-white p-6 rounded-3xl shadow-lg border border-blue-50 text-center hover:scale-105 transition">
                <i class="fas fa-snowflake text-2xl text-[#001e50] mb-3"></i>
                <p class="text-xs font-black">××™×–×•×’ ××•×•×™×¨</p>
            </div>
            <div class="bg-white p-6 rounded-3xl shadow-lg border border-blue-50 text-center hover:scale-105 transition">
                <i class="fas fa-car-battery text-2xl text-[#001e50] mb-3"></i>
                <p class="text-xs font-black">×—×©××œ</p>
            </div>
            <div class="bg-white p-6 rounded-3xl shadow-lg border border-blue-50 text-center hover:scale-105 transition">
                <i class="fas fa-file-contract text-2xl text-[#001e50] mb-3"></i>
                <p class="text-xs font-black">×”×›× ×” ×œ×˜×¡×˜</p>
            </div>
        </div>
    </section>

    <div class="max-w-md mx-auto mt-8 px-6">
        <div class="bg-amber-50 border-r-4 border-amber-400 p-4 rounded-2xl flex items-center gap-4">
            <span class="text-2xl">ğŸ’¡</span>
            <div>
                <p id="dailyTip" class="text-xs text-amber-900 font-bold"></p>
            </div>
        </div>
    </div>

    <div class="max-w-md mx-auto mt-6 px-6">
        <div class="bg-white rounded-[2.5rem] p-6 shadow-sm border border-blue-100 relative">
            <div class="flex items-center gap-2 mb-4">
                <div class="w-2 h-2 bg-blue-500 rounded-full animate-ping"></div>
                <h4 class="font-black text-sm text-gray-800">GiminAI - ××•××—×” VAG</h4>
            </div>
            <input id="aiInput" type="text" placeholder="×©××œ ×¢×œ ×ª×§×œ×”, × ×•×¨×” ××• ×˜×™×¤×•×œ..." class="w-full bg-gray-50 p-4 rounded-2xl text-xs outline-none focus:ring-2 ring-blue-900/10 border-none">
            <button onclick="askAI()" class="w-full mt-3 bg-[#001e50] text-white p-4 rounded-2xl text-xs font-black shadow-lg active:scale-95 transition">×©××œ ××•××—×”</button>
            <p id="aiResponse" class="mt-4 text-[11px] text-gray-600 hidden bg-blue-50 p-4 rounded-2xl leading-relaxed italic border border-blue-100"></p>
        </div>
    </div>

    <div class="mt-12 vag-blue py-14 px-6 overflow-hidden">
        <h3 class="text-white text-center font-black mb-8">××” ×”×œ×§×•×—×•×ª ×©×œ× ×• ××•××¨×™× (Google 5â˜…)</h3>
        <div id="reviewsContainer" class="flex gap-4 overflow-x-auto pb-4 ltr no-scrollbar">
            </div>
    </div>

    <div class="fixed bottom-0 left-0 right-0 p-4 bg-white/90 backdrop-blur-xl border-t z-[100] grid grid-cols-2 gap-3 max-w-md mx-auto shadow-2xl">
        <button onclick="openModal('loginModal')" class="bg-[#001e50] text-white p-4 rounded-2xl font-black text-sm">×›× ×™×¡×” ×œ××–×•×¨ ××™×©×™</button>
        <button onclick="openModal('regModal')" class="bg-white border-2 border-[#001e50] text-[#001e50] p-4 rounded-2xl font-black text-sm">×”×¨×©××”</button>
        <a href="tel:086277195" class="bg-green-600 text-white p-3 rounded-xl text-center font-black text-xs ltr"><i class="fas fa-phone-alt mr-1"></i> 08-6277195</a>
        <a href="https://waze.com/ul?q=×¤× ×—×¡ ×”×—×•×¦×‘ 35 ×‘××¨ ×©×‘×¢" target="_blank" class="bg-blue-500 text-white p-3 rounded-xl text-center font-black text-xs"><i class="fas fa-location-arrow ml-1"></i> × ×™×•×•×˜ ×œ××•×¡×š</a>
    </div>

    <div id="regModal" class="hidden fixed inset-0 bg-black/80 z-[200] flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-md rounded-[2.5rem] p-8 max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-black text-[#001e50] mb-6 border-b pb-4">×”×¨×©××” ×œ××¢×¨×›×ª</h2>
            <div class="space-y-3">
                <div class="grid grid-cols-2 gap-2">
                    <input id="rFName" type="text" placeholder="×©× ×¤×¨×˜×™ *" class="p-4 bg-gray-50 rounded-2xl border text-sm" required>
                    <input id="rLName" type="text" placeholder="×©× ××©×¤×—×” *" class="p-4 bg-gray-50 rounded-2xl border text-sm" required>
                </div>
                <input id="rID" type="number" placeholder="×ª×¢×•×“×ª ×–×”×•×ª *" class="w-full p-4 bg-gray-50 rounded-2xl border text-sm ltr" required>
                <input id="rPhone" type="tel" placeholder="×˜×œ×¤×•×Ÿ *" class="w-full p-4 bg-gray-50 rounded-2xl border text-sm ltr" required>
                <input id="rAddr" type="text" placeholder="×›×ª×•×‘×ª ××œ××” *" class="w-full p-4 bg-gray-50 rounded-2xl border text-sm" required>
                <div class="grid grid-cols-2 gap-2">
                    <input id="rModel" type="text" placeholder="×“×’× ×¨×›×‘ *" class="p-4 bg-gray-50 rounded-2xl border text-sm" required>
                    <input id="rYear" type="number" placeholder="×©× ×ª ×™×™×¦×•×¨ *" class="p-4 bg-gray-50 rounded-2xl border text-sm ltr" required>
                </div>
                <input id="rKm" type="number" placeholder="×§×™×œ×•××˜×¨ ×¢×“×›× ×™ *" class="w-full p-4 bg-gray-50 rounded-2xl border text-sm ltr" required>
                <input id="rPlate" type="number" placeholder="××¡×¤×¨ ×¨×›×‘ *" class="w-full p-5 bg-blue-50 border-blue-200 rounded-2xl font-black ltr text-center" required>
                <button onclick="handleRegister()" class="w-full bg-[#001e50] text-white p-5 rounded-2xl font-black mt-4 shadow-xl">×¤×ª×— ×—×©×‘×•×Ÿ</button>
                <button onclick="closeModal('regModal')" class="w-full text-gray-400 font-bold p-2 text-xs">×‘×™×˜×•×œ</button>
            </div>
        </div>
    </div>

    <div id="loginModal" class="hidden fixed inset-0 bg-black/80 z-[200] flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-[3rem] p-10 text-center">
            <h2 class="text-2xl font-black text-[#001e50] mb-8 italic">×©×œ×•×, ×›× ×™×¡×”</h2>
            <div class="space-y-4">
                <input id="lID" type="number" placeholder="×ª×¢×•×“×ª ×–×”×•×ª" class="w-full p-5 bg-gray-50 rounded-2xl ltr text-center font-bold border">
                <input id="lPlate" type="number" placeholder="××¡×¤×¨ ×¨×›×‘" class="w-full p-5 bg-gray-50 rounded-2xl ltr text-center font-bold border">
                <button onclick="handleLogin()" class="w-full bg-[#001e50] text-white p-5 rounded-2xl font-black shadow-lg">×›× ×™×¡×” ×œ××–×•×¨ ××™×©×™</button>
                <button onclick="closeModal('loginModal')" class="text-gray-400 font-bold text-xs mt-4">×—×–×•×¨</button>
            </div>
        </div>
    </div>

    <div id="personalArea" class="hidden fixed inset-0 bg-[#f8fafc] z-[300] overflow-y-auto pb-32">
        <nav class="bg-white p-6 border-b flex justify-between items-center sticky top-0 z-50">
            <div>
                <h2 id="uName" class="font-black text-[#001e50] italic text-lg">×˜×•×¢×Ÿ × ×ª×•× ×™×...</h2>
                <p id="uCarInfo" class="text-[10px] font-bold text-gray-400 ltr"></p>
            </div>
            <button onclick="logout()" class="text-red-500 bg-red-50 p-3 rounded-2xl"><i class="fas fa-power-off"></i></button>
        </nav>

        <main class="p-6 space-y-6 max-w-md mx-auto">
            
            <div id="smartBanner" class="hidden bg-[#001e50] text-white p-5 rounded-3xl shadow-xl flex items-center gap-4">
                <i class="fas fa-bell text-yellow-400 animate-bounce"></i>
                <p id="bannerMsg" class="text-[11px] font-black leading-tight"></p>
            </div>

            <div id="quoteSection" class="hidden bg-white rounded-3xl p-6 shadow-xl border-2 border-amber-200">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="font-black text-amber-600">×”×¦×¢×ª ××—×™×¨ ×œ××™×©×•×¨</h4>
                    <button onclick="downloadQuote()" class="text-blue-600 text-[10px] font-bold underline">×”×•×¨×“ PDF</button>
                </div>
                <div id="quoteBody" class="text-[11px] space-y-2 mb-6 bg-slate-50 p-4 rounded-xl"></div>
                <p class="text-[10px] text-gray-400 font-bold mb-2">×—×ª×•× ×œ××™×©×•×¨:</p>
                <canvas id="sigPad"></canvas>
                <button onclick="approveQuote()" class="w-full mt-4 bg-green-600 text-white p-4 rounded-2xl font-black">××©×¨ ×•×—×ª×•× ×¢×›×©×™×•</button>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white p-5 rounded-3xl shadow-sm border border-gray-100 text-center">
                    <p class="text-[9px] text-gray-400 font-black">×˜×¡×˜ ×”×‘×</p>
                    <p id="pNextTest" class="text-xs font-black text-blue-900 ltr">--/--/--</p>
                </div>
                <div class="bg-white p-5 rounded-3xl shadow-sm border border-gray-100 text-center">
                    <p class="text-[9px] text-gray-400 font-black">×˜×™×¤×•×œ ×”×‘×</p>
                    <p id="pNextServ" class="text-xs font-black text-blue-900 ltr">--/--/--</p>
                </div>
            </div>

            <div class="bg-white rounded-3xl p-6 shadow-sm border">
                <h4 class="font-black text-sm mb-4"><i class="fas fa-calendar-alt ml-2 text-blue-900"></i>×§×‘×™×¢×ª ×ª×•×¨</h4>
                <div class="space-y-3">
                    <input id="appDate" type="date" class="w-full p-4 bg-gray-50 rounded-2xl text-xs ltr">
                    <select id="appTime" class="w-full p-4 bg-gray-50 rounded-2xl text-xs ltr font-bold text-blue-900">
                        <option value="07:30">07:30</option><option value="08:30">08:30</option>
                        <option value="10:00">10:00</option><option value="12:00">12:00</option>
                        <option value="14:00">14:00</option><option value="15:00">15:00</option>
                    </select>
                    <button onclick="bookAppt()" class="w-full bg-[#001e50] text-white p-4 rounded-2xl font-black text-xs shadow-lg">×§×‘×¢ ×ª×•×¨</button>
                </div>
                <div id="activeAppts" class="mt-4 space-y-2"></div>
            </div>

            <div class="bg-white rounded-3xl p-6 shadow-sm border">
                <h4 class="font-black text-sm mb-4">×”×•×“×¢×•×ª ××”××•×¡×š</h4>
                <div id="inbox" class="space-y-3 text-[11px] text-gray-500 italic">××™×Ÿ ×”×•×“×¢×•×ª.</div>
            </div>

            <div class="bg-white rounded-3xl p-6 shadow-sm border">
                <h4 class="font-black text-sm mb-6 underline decoration-blue-900 decoration-4 underline-offset-8">×”×™×¡×˜×•×¨×™×™×ª ×¨×›×‘ (×©× ×ª×™×™× ××—×•×¨×”)</h4>
                <div class="flex gap-4 overflow-x-auto border-b mb-4 no-scrollbar">
                    <button onclick="switchTab('h-quotes', this)" class="tab-btn active pb-2 text-[10px] font-black whitespace-nowrap">×”×¦×¢×•×ª ××—×™×¨</button>
                    <button onclick="switchTab('h-serv', this)" class="tab-btn pb-2 text-[10px] font-black whitespace-nowrap">×˜×™×¤×•×œ×™×</button>
                    <button onclick="switchTab('h-test', this)" class="tab-btn pb-2 text-[10px] font-black whitespace-nowrap">×˜×¡×˜×™×</button>
                    <button onclick="switchTab('h-check', this)" class="tab-btn pb-2 text-[10px] font-black whitespace-nowrap">×‘×™×§×•×¨×ª</button>
                </div>
                <div id="h-quotes" class="tab-content text-[11px] space-y-3"></div>
                <div id="h-serv" class="tab-content hidden text-[11px] space-y-3"></div>
                <div id="h-test" class="tab-content hidden text-[11px] space-y-3"></div>
                <div id="h-check" class="tab-content hidden text-[11px] space-y-3"></div>
            </div>
        </main>
    </div>

    <script>
        // --- Firebase Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyDD7YAdTePRWYjwBbmy3gLRYd_OLDwpTL8",
            authDomain: "baram-vag-45e12.firebaseapp.com",
            projectId: "baram-vag-45e12",
            storageBucket: "baram-vag-45e12.firebasestorage.app",
            messagingSenderId: "761383355945",
            appId: "1:761383355945:web:552554b5a6b9fe5e78be38"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- Core UI & Live Data ---
        function updateUI() {
            const now = new Date();
            document.getElementById('liveDate').innerText = now.toLocaleDateString('he-IL', {weekday:'long', day:'numeric', month:'numeric'});
            document.getElementById('liveTime').innerText = now.toLocaleTimeString('he-IL', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
        }
        setInterval(updateUI, 1000); updateUI();

        const tips = [
            "×‘×“×™×§×ª ×©××Ÿ ×¤×¢× ×‘×©×‘×•×¢×™×™× ×©×•××¨×ª ×¢×œ ×× ×•×¢×™ ×”-TSI/TDI ×©×œ×š.",
            "× ×•×¨×ª ×× ×•×¢ ×¦×”×•×‘×”? ××œ ×ª××ª×™×Ÿ, ×¡×¨×™×§×ª ××—×©×‘ ××•× ×¢×ª × ×–×§ ×›×‘×“.",
            "×‘×“×™×§×ª ×—×•×¨×£ ×—×™× × ××¦×œ× ×• ×‘×‘×¨×¢×´×! ×‘×•××• ×œ×•×•×“× ×‘×˜×™×—×•×ª.",
            "××™×–×•×’ ××•×•×™×¨ ×—×œ×©? ×™×™×ª×›×Ÿ ×•××¡× ×Ÿ ×”××–×’×Ÿ ×¡×ª×•×. ×‘×•××• ×œ×”×—×œ×™×£."
        ];
        document.getElementById('dailyTip').innerText = tips[new Date().getDate() % tips.length];

        function genReviews() {
            const cont = document.getElementById('reviewsContainer');
            const texts = ["×©×™×¨×•×ª ×¤×¦×¦×” ×œ××•×“×™ ×©×œ×™!", "××§×¦×•×¢× ×™× ×‘×¨××•×ª, ×”×›×™ ×˜×•×‘×™× ×‘×‘××¨ ×©×‘×¢.", "×¨×§ ×‘×¨×¢×´× ×× ×™ ××˜×¤×œ ×‘×’×•×œ×£.", "×××™× ×•×ª ××¢×œ ×”×›×œ.", "××•××—×™× ×××™×ª×™×™× ×œ×›×œ ×§×‘×•×¦×ª VAG."];
            for(let i=0; i<10; i++) {
                cont.innerHTML += `<div class="min-w-[260px] bg-white/10 p-6 rounded-3xl border border-white/20 text-white text-right">
                    <div class="flex text-yellow-400 text-[8px] mb-2">${'<i class="fas fa-star"></i>'.repeat(5)}</div>
                    <p class="text-[11px] italic">"${texts[i%5]}"</p>
                </div>`;
            }
        }
        genReviews();

        // --- AI EXPERT ---
        function askAI() {
            const q = document.getElementById('aiInput').value.toLowerCase();
            const res = document.getElementById('aiResponse');
            res.classList.remove('hidden');
            if(q.includes('vag') || q.includes('×¤×•×œ×§×¡') || q.includes('××•×“×™') || q.includes('×¡×™××˜') || q.includes('×¡×§×•×“×”') || q.includes('×’×•×œ×£') || q.includes('××™×‘×™×–×”')) {
                res.innerText = "×©×œ×•×, ×× ×™ GiminAI. ×¢×‘×•×¨ ×¨×›×‘×™ VAG, ×”×ª×•×¤×¢×” ×©×ª×™××¨×ª ×“×•×¨×©×ª ×‘×“×™×§×ª ××—×©×‘ ODIS ××§×¦×•×¢×™×ª. ×™×™×ª×›×Ÿ ×©×™×© ×¦×•×¨×š ×‘×¢×“×›×•×Ÿ ×ª×•×›× ×” ××• × ×™×§×•×™ ×¤×™×—. × ×©××— ×œ×‘×“×•×§!";
            } else {
                res.innerText = "×× ×™ ××•××—×” ×™×™×¢×•×“×™ ×œ×¨×›×‘×™ ×§×‘×•×¦×ª VAG ×‘×œ×‘×“. ×©××œ ××•×ª×™ ×¢×œ×™×”×!";
            }
        }

        // --- Auth & Data Handling ---
        async function handleRegister() {
            const plate = document.getElementById('rPlate').value;
            const user = {
                fName: document.getElementById('rFName').value,
                lName: document.getElementById('rLName').value,
                id: document.getElementById('rID').value,
                phone: document.getElementById('rPhone').value,
                addr: document.getElementById('rAddr').value,
                model: document.getElementById('rModel').value,
                year: document.getElementById('rYear').value,
                km: document.getElementById('rKm').value,
                plate: plate,
                history: { quotes:[], services:[], tests:[], checks:[] }
            };
            if(!plate || !user.id) return alert("××œ× ×©×“×•×ª ×—×•×‘×”");
            await db.collection("customers").doc(plate).set(user);
            alert("× ×¨×©××ª ×‘×”×¦×œ×—×”!"); location.reload();
        }

        async function handleLogin() {
            const id = document.getElementById('lID').value;
            const plate = document.getElementById('lPlate').value;
            const doc = await db.collection("customers").doc(plate).get();
            if(doc.exists && doc.data().id === id) {
                localStorage.setItem('uPlate', plate);
                initDashboard(doc.data());
            } else alert("× ×ª×•× ×™× ×©×’×•×™×™×!");
        }

        let sigPad;
        function initDashboard(user) {
            document.getElementById('personalArea').classList.remove('hidden');
            document.getElementById('uName').innerText = `×©×œ×•×, ${user.fName} ${user.lName}`;
            document.getElementById('uCarInfo').innerText = `${user.model} | ${user.plate}`;
            
            sigPad = new SignaturePad(document.getElementById('sigPad'));
            checkSmartAlerts(user);
            renderHistory(user.history);
            loadAppointments(user.plate);

            const pending = (user.history.quotes || []).find(q => !q.signed);
            if(pending) {
                document.getElementById('quoteSection').classList.remove('hidden');
                document.getElementById('quoteBody').innerHTML = `<b>${pending.title}</b><p>${pending.desc}</p><p class="text-blue-900 font-black">â‚ª${pending.total}</p>`;
                window.activeQuote = pending;
            }
        }

        function checkSmartAlerts(user) {
            const month = new Date().getMonth() + 1;
            const banner = document.getElementById('smartBanner');
            const msg = document.getElementById('bannerMsg');
            banner.classList.remove('hidden');
            
            if(month >= 11 || month <= 2) msg.innerText = "×‘×“×™×§×ª ×—×•×¨×£ ×‘×—×™× ×! ×‘×•××• ×œ×”×›×™×Ÿ ××ª ×”-VAG ×©×œ×›× ×œ×›×‘×™×© ×¨×˜×•×‘.";
            else if(month >= 6 && month <= 8) msg.innerText = "×§×™×¥ ×œ×•×”×˜! ×‘×•××• ×œ×‘×“×™×§×ª ××–×’×Ÿ ×•× ×•×–×œ ×§×™×¨×•×¨ ××§×•×¨×™.";
            else msg.innerText = "×˜×™×¤×•×œ ×”×‘× ×‘-15,000 ×§×´× ××• ×©× ×”. ×‘×“×•×§ ×”×™×¡×˜×•×¨×™×”.";
        }

        function renderHistory(hist) {
            const twoYearsAgo = new Date(); twoYearsAgo.setFullYear(twoYearsAgo.getFullYear() - 2);
            const filter = (arr) => (arr || []).filter(i => new Date(i.date) > twoYearsAgo);

            const mapData = (arr, elId) => {
                const data = filter(arr);
                document.getElementById(elId).innerHTML = data.length ? data.map(i => `<div class="p-3 bg-gray-50 rounded-xl border flex justify-between"><span>${i.desc}</span><span class="ltr font-bold">${i.date}</span></div>`).join('') : "××™×Ÿ ××™×“×¢ ×œ×©× ×ª×™×™× ×”××—×¨×•× ×•×ª.";
            };

            mapData(hist.quotes, 'h-quotes');
            mapData(hist.services, 'h-serv');
            mapData(hist.tests, 'h-test');
            mapData(hist.checks, 'h-check');
        }

        async function approveQuote() {
            if(sigPad.isEmpty()) return alert("× × ×œ×—×ª×•×!");
            const plate = localStorage.getItem('uPlate');
            // Logic to update firestore with signature...
            alert("×”×”×¦×¢×” ××•×©×¨×” ×•× ×©×œ×—×” ×œ××•×¡×š!");
            location.reload();
        }

        async function bookAppt() {
            const plate = localStorage.getItem('uPlate');
            const date = document.getElementById('appDate').value;
            const time = document.getElementById('appTime').value;
            if(!date) return alert("×‘×—×¨ ×ª××¨×™×š");
            await db.collection("appointments").add({ plate, date, time, status: "×××ª×™×Ÿ" });
            alert("×”×ª×•×¨ × ×§×‘×¢ ×‘×”×¦×œ×—×”!"); location.reload();
        }

        function switchTab(tabId, btn) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.remove('hidden');
            btn.classList.add('active');
        }

        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function logout() { localStorage.clear(); location.reload(); }
    </script>
</body>
</html>
