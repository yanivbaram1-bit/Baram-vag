<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מרכז שירות ברע״מ - VAG Specialist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;700;800&display=swap');
        body { font-family: 'Assistant', sans-serif; background-color: #f3f4f6; }
        .ltr { direction: ltr; display: inline-block; }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        .category-card { transition: all 0.3s ease; }
        .category-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .hidden { display: none !important; }
    </style>
</head>
<body class="pb-20">

    <header class="bg-white pt-8 pb-6 text-center border-b shadow-sm">
        <div class="bg-blue-900 text-white inline-block px-6 py-2 rounded-xl font-black italic text-2xl mb-1">VAG</div>
        <h1 class="text-3xl font-black text-blue-900">מרכז שירות ברע״מ</h1>
        <p class="text-gray-500 font-bold">באר שבע</p>
    </header>

    <div class="max-w-md mx-auto mt-4 px-4">
        <div class="bg-blue-900 text-white rounded-2xl p-4 flex justify-between items-center shadow-lg">
            <div id="currentDate" class="text-sm font-bold"></div>
            <div class="text-[10px] bg-white/20 px-3 py-1 rounded-full">
                שעות פעילות: 08:00 - 17:00
            </div>
        </div>
    </div>

    <div class="relative mt-8 px-4">
        <div class="bg-blue-900 rounded-[2rem] p-8 text-center text-white mb-[-50px]">
            <h2 class="text-xl font-black mb-2 uppercase tracking-widest">מומחי VAG</h2>
            <p class="text-sm opacity-80">סיאט • סקודה • אודי • פולקסווגן</p>
        </div>
        
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 relative z-10 px-2">
            <div class="category-card bg-white p-6 rounded-3xl text-center shadow-md">
                <i class="fas fa-tools text-2xl text-blue-900 mb-2"></i>
                <p class="text-xs font-black">מכונאות</p>
            </div>
            <div class="category-card bg-white p-6 rounded-3xl text-center shadow-md">
                <i class="fas fa-bolt text-2xl text-blue-900 mb-2"></i>
                <p class="text-xs font-black">דיאגנוסטיקה</p>
            </div>
            <div class="category-card bg-white p-6 rounded-3xl text-center shadow-md">
                <i class="fas fa-oil-can text-2xl text-blue-900 mb-2"></i>
                <p class="text-xs font-black">טיפול תקופתי</p>
            </div>
            <div class="category-card bg-white p-6 rounded-3xl text-center shadow-md">
                <i class="fas fa-snowflake text-2xl text-blue-900 mb-2"></i>
                <p class="text-xs font-black">מיזוג אוויר</p>
            </div>
            <div class="category-card bg-white p-6 rounded-3xl text-center shadow-md">
                <i class="fas fa-microchip text-2xl text-blue-900 mb-2"></i>
                <p class="text-xs font-black">קידוד שלטים</p>
            </div>
            <div class="category-card bg-white p-6 rounded-3xl text-center shadow-md">
                <i class="fas fa-shield-alt text-2xl text-blue-900 mb-2"></i>
                <p class="text-xs font-black">הכנה לטסט</p>
            </div>
        </div>
    </div>

    <div class="max-w-md mx-auto mt-12 px-4">
        <div class="bg-green-50 border-r-4 border-green-500 p-4 rounded-xl">
            <h4 class="font-black text-green-700 text-sm mb-1"><i class="fas fa-lightbulb ml-2"></i>טיפ יומי</h4>
            <p id="dailyTip" class="text-xs text-green-600 font-bold">טוען טיפ מומחה...</p>
        </div>
    </div>

    <div class="max-w-md mx-auto mt-6 px-4">
        <div class="bg-white rounded-3xl p-6 shadow-sm border border-blue-100">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center text-white">
                    <i class="fas fa-robot"></i>
                </div>
                <div>
                    <h4 class="font-black text-sm">מומחה AI - Gemini</h4>
                    <p class="text-[10px] text-gray-400">שאל אותי הכל על רכבי VAG</p>
                </div>
            </div>
            <input id="aiInput" type="text" placeholder="למה נדלקת נורת EPC באודי?" class="w-full bg-gray-50 p-3 rounded-xl text-xs outline-none focus:ring-2 ring-blue-900">
            <button onclick="askAI()" class="w-full mt-2 bg-blue-900 text-white p-3 rounded-xl text-xs font-bold">שאל מומחה</button>
            <p id="aiResponse" class="mt-4 text-[11px] text-gray-600 hidden bg-gray-50 p-3 rounded-lg"></p>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-4 px-6 mt-8">
        <button onclick="showModal('loginModal')" class="bg-blue-900 text-white p-4 rounded-2xl font-black shadow-lg">כניסה</button>
        <button onclick="showModal('regModal')" class="bg-white border-2 border-blue-900 text-blue-900 p-4 rounded-2xl font-black">הרשמה</button>
    </div>

    <div class="mt-12 bg-blue-900 py-10 px-6 overflow-hidden">
        <h3 class="text-white font-black text-center mb-6">ביקורות לקוחות (5 כוכבים)</h3>
        <div class="flex gap-4 animate-scroll">
            <div class="min-w-[250px] bg-white/10 p-4 rounded-2xl border border-white/20 text-white">
                <div class="flex text-yellow-400 text-[10px] mb-2">
                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                </div>
                <p class="text-xs italic mb-2">"המוסך הכי מקצועי באזור לרכבי פולקסווגן. שירות אדיב ומחירים הוגנים."</p>
                <p class="text-[10px] font-bold opacity-60">- ישראל ישראלי</p>
            </div>
            </div>
    </div>

    <div class="fixed bottom-6 left-0 right-0 px-6 flex gap-3 z-50">
        <a href="tel:086277195" class="flex-1 bg-green-500 text-white p-4 rounded-2xl text-center shadow-2xl font-black">
            <i class="fas fa-phone-alt ml-2"></i>חיוג
        </a>
        <a href="https://waze.com/ul?q=פנחס החוצב 35 באר שבע" target="_blank" class="flex-1 bg-blue-600 text-white p-4 rounded-2xl text-center shadow-2xl font-black">
            <i class="fas fa-location-arrow ml-2"></i>ניווט
        </a>
    </div>

    <div id="regModal" class="hidden fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-md rounded-[2.5rem] p-8 max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-black text-blue-900 mb-6">רישום לקוח חדש</h2>
            <div class="space-y-4">
                <input id="rFName" type="text" placeholder="שם מלא" class="w-full p-4 bg-gray-50 rounded-2xl border-none">
                <input id="rLName" type="text" placeholder="שם משפחה" class="w-full p-4 bg-gray-50 rounded-2xl border-none">
                <input id="rID" type="number" placeholder="תעודת זהות" class="w-full p-4 bg-gray-50 rounded-2xl border-none ltr">
                <input id="rPhone" type="number" placeholder="טלפון" class="w-full p-4 bg-gray-50 rounded-2xl border-none ltr">
                <input id="rAddr" type="text" placeholder="כתובת" class="w-full p-4 bg-gray-50 rounded-2xl border-none">
                <input id="rModel" type="text" placeholder="דגם רכב (לדוגמה: גולף)" class="w-full p-4 bg-gray-50 rounded-2xl border-none">
                <input id="rYear" type="number" placeholder="שנת ייצור" class="w-full p-4 bg-gray-50 rounded-2xl border-none ltr">
                <input id="rKm" type="number" placeholder="קילומטר עדכני" class="w-full p-4 bg-gray-50 rounded-2xl border-none ltr">
                <input id="rPlate" type="number" placeholder="מספר רכב" class="w-full p-4 bg-gray-50 rounded-2xl border-none ltr">
                <button onclick="handleRegister()" class="w-full bg-blue-900 text-white p-5 rounded-2xl font-black">צור חשבון</button>
                <button onclick="closeModal('regModal')" class="w-full text-gray-400 font-bold">ביטול</button>
            </div>
        </div>
    </div>

    <div id="loginModal" class="hidden fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-[2.5rem] p-8 text-center">
            <h2 class="text-2xl font-black text-blue-900 mb-2">כניסה לאזור אישי</h2>
            <p class="text-xs text-gray-400 mb-8">הזן ת.ז ומספר רכב לזיהוי</p>
            <input id="lID" type="number" placeholder="תעודת זהות" class="w-full p-4 bg-gray-50 rounded-2xl mb-4 ltr text-center font-bold">
            <input id="lPlate" type="number" placeholder="מספר רכב" class="w-full p-4 bg-gray-50 rounded-2xl mb-6 ltr text-center font-bold">
            <button onclick="handleLogin()" class="w-full bg-blue-900 text-white p-5 rounded-2xl font-black shadow-lg">כניסה</button>
            <button onclick="closeModal('loginModal')" class="w-full mt-4 text-gray-400 font-bold">חזור</button>
        </div>
    </div>

    <div id="personalArea" class="hidden fixed inset-0 bg-gray-100 z-[200] overflow-y-auto pb-24">
        <header class="bg-white p-6 border-b flex justify-between items-center sticky top-0">
            <h2 id="welcomeName" class="font-black text-blue-900">שלום, לקוח</h2>
            <button onclick="logout()" class="text-red-500 font-bold text-sm">התנתק</button>
        </header>

        <div class="p-6 space-y-6">
            <div id="notificationBanner" class="hidden bg-amber-100 border-r-4 border-amber-500 p-4 rounded-xl text-xs font-bold text-amber-900 animate-pulse">
                <i class="fas fa-bell ml-2"></i> <span id="notifText"></span>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-blue-50">
                    <p class="text-[10px] text-gray-400 font-bold">טיפול הבא</p>
                    <p id="pNextS" class="text-sm font-black text-blue-900 ltr">01/01/2026</p>
                </div>
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-blue-50">
                    <p class="text-[10px] text-gray-400 font-bold">טסט הבא</p>
                    <p id="pNextT" class="text-sm font-black text-blue-900 ltr">01/01/2026</p>
                </div>
            </div>

            <div class="bg-white p-6 rounded-3xl shadow-sm">
                <h4 class="font-black text-sm mb-4">קביעת תור למוסך</h4>
                <div class="space-y-3">
                    <input id="appDate" type="date" class="w-full p-3 bg-gray-50 rounded-xl text-sm ltr">
                    <select id="appTime" class="w-full p-3 bg-gray-50 rounded-xl text-sm ltr">
                        <option value="08:00">08:00</option>
                        <option value="09:00">09:00</option>
                        <option value="10:00">10:00</option>
                        <option value="11:00">11:00</option>
                        <option value="12:00">12:00</option>
                        <option value="13:00">13:00</option>
                        <option value="14:00">14:00</option>
                        <option value="15:00">15:00</option>
                        <option value="16:00">16:00</option>
                    </select>
                    <button onclick="bookAppt()" class="w-full bg-blue-900 text-white p-3 rounded-xl font-bold">קבע תור</button>
                </div>
                <div id="activeAppts" class="mt-4 space-y-2"></div>
            </div>

            <div class="bg-white p-6 rounded-3xl shadow-sm">
                <h4 class="font-black text-sm mb-4">הודעות מהמוסך</h4>
                <div id="messagesList" class="space-y-3 text-[11px] text-gray-600 italic">
                    אין הודעות חדשות.
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Config (Keep your credentials)
        const firebaseConfig = {
            apiKey: "AIzaSyDD7YAdTePRWYjwBbmy3gLRYd_OLDwpTL8",
            authDomain: "baram-vag-45e12.firebaseapp.com",
            projectId: "baram-vag-45e12",
            storageBucket: "baram-vag-45e12.firebasestorage.app",
            messagingSenderId: "761383355945",
            appId: "1:761383355945:web:552554b5a6b9fe5e78be38"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 1. Current Date & Time
        function updateClock() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').innerText = now.toLocaleDateString('he-IL', options);
        }
        setInterval(updateClock, 1000);
        updateClock();

        // 2. Daily Tip Logic
        const tips = [
            "מומלץ לבדוק שמן ומים בכל רכב VAG פעם בשבועיים.",
            "נורת EPC יכולה להעיד על מצערת מלוכלכת - בואו לבדיקה.",
            "בחורף, וודאו שמגבי הרכב תקינים למניעת שריטות בשמשה.",
            "טיפול בזמן מונע נזק יקר לתיבת ההילוכים מסוג DSG."
        ];
        document.getElementById('dailyTip').innerText = tips[new Date().getDate() % tips.length];

        // 3. Gemini AI Simulation (Filtered for VAG)
        function askAI() {
            const input = document.getElementById('aiInput').value.toLowerCase();
            const response = document.getElementById('aiResponse');
            response.classList.remove('hidden');
            
            if (input.includes('vag') || input.includes('אודי') || input.includes('פולקסווגן') || input.includes('סקודה') || input.includes('סיאט') || input.includes('שמן') || input.includes('טיפול')) {
                response.innerText = "כמומחה Gemini לרכבי VAG, אני ממליץ לבדוק את הבעיה במוסך ברע״מ. לפי התיאור שלך, ייתכן ומדובר בחיישן תקול או צורך בעדכון תוכנה למחשב הרכב.";
            } else {
                response.innerText = "מצטער, אני מומחה רק לרכבי קבוצת VAG (פולקסווגן, אודי, סיאט, סקודה). שאל אותי עליהם!";
            }
        }

        // 4. Auth & Registration
        async function handleRegister() {
            const plate = document.getElementById('rPlate').value;
            const userData = {
                fName: document.getElementById('rFName').value,
                lName: document.getElementById('rLName').value,
                id: document.getElementById('rID').value,
                phone: document.getElementById('rPhone').value,
                addr: document.getElementById('rAddr').value,
                model: document.getElementById('rModel').value,
                year: document.getElementById('rYear').value,
                km: document.getElementById('rKm').value,
                plate: plate,
                nextS: "טרם נקבע",
                nextT: "טרם נקבע",
                messages: []
            };

            if(!plate || !userData.id) return alert("אנא מלא את כל השדות חובה");

            await db.collection("customers").doc(plate).set(userData);
            alert("נרשמת בהצלחה! כעת ניתן להיכנס.");
            closeModal('regModal');
        }

        async function handleLogin() {
            const id = document.getElementById('lID').value;
            const plate = document.getElementById('lPlate').value;

            const doc = await db.collection("customers").doc(plate).get();
            if(doc.exists && doc.data().id === id) {
                localStorage.setItem('userPlate', plate);
                showPersonalArea(doc.data());
            } else {
                alert("פרטים שגויים");
            }
        }

        // 5. Personal Area & Notifications
        function showPersonalArea(data) {
            document.getElementById('personalArea').classList.remove('hidden');
            document.getElementById('welcomeName').innerText = `שלום, ${data.fName}`;
            document.getElementById('pNextS').innerText = data.nextS;
            document.getElementById('pNextT').innerText = data.nextT;
            
            checkSmartNotifications(data);
            loadAppts(data.plate);
            loadMessages(data.plate);
        }

        function checkSmartNotifications(data) {
            const banner = document.getElementById('notificationBanner');
            const notifText = document.getElementById('notifText');
            const now = new Date();
            const month = now.getMonth() + 1; // 1-12

            // Winter/Summer check
            if (month === 11) {
                banner.classList.remove('hidden');
                notifText.innerText = "חורף בפתח! בואו לבדיקת חורף חינם במוסך ברע״מ.";
            } else if (month === 5) {
                banner.classList.remove('hidden');
                notifText.innerText = "הקיץ כאן. זמן לוודא שהמזגן ברכב ה-VAG שלך מוכן.";
            }
        }

        async function bookAppt() {
            const plate = localStorage.getItem('userPlate');
            const date = document.getElementById('appDate').value;
            const time = document.getElementById('appTime').value;

            await db.collection("appointments").add({
                plate, date, time, status: "מאושר"
            });
            alert("התור נקבע בהצלחה!");
            location.reload();
        }

        function loadAppts(plate) {
            db.collection("appointments").where("plate", "==", plate).onSnapshot(snap => {
                const cont = document.getElementById('activeAppts');
                cont.innerHTML = "<p class='text-[10px] font-bold border-b pb-1'>התורים שלך:</p>";
                snap.forEach(doc => {
                    const a = doc.data();
                    cont.innerHTML += `<div class="flex justify-between text-xs bg-gray-50 p-2 rounded-lg">
                        <span class="ltr">${a.date} | ${a.time}</span>
                        <button onclick="cancelAppt('${doc.id}')" class="text-red-500 font-bold italic">ביטול</button>
                    </div>`;
                });
            });
        }

        async function cancelAppt(id) {
            if(confirm("לבטל את התור?")) {
                await db.collection("appointments").doc(id).delete();
            }
        }

        function loadMessages(plate) {
            db.collection("customers").doc(plate).onSnapshot(doc => {
                const msgs = doc.data().messages || [];
                const cont = document.getElementById('messagesList');
                if(msgs.length > 0) {
                    cont.innerHTML = "";
                    msgs.forEach(m => {
                        cont.innerHTML += `<div class="bg-blue-50 p-3 rounded-xl border-r-2 border-blue-900">${m.text} <br><span class="text-[8px] opacity-50">${m.date}</span></div>`;
                    });
                }
            });
        }

        function showModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function logout() { localStorage.clear(); location.reload(); }
    </script>
</body>
</html>
