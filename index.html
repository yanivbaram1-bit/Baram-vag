<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¨×›×– ×©×™×¨×•×ª ×‘×¨×¢×´× | VAG Specialist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;800&display=swap');
        body { font-family: 'Assistant', sans-serif; background: #f8fafc; color: #1e293b; }
        .ltr { direction: ltr; display: inline-block; }
        .vag-blue { background-color: #001e50; }
        .category-grid { position: relative; z-index: 20; margin-top: -60px; }
        .tab-btn.active { border-bottom: 3px solid #001e50; color: #001e50; }
        canvas { border: 1px dashed #cbd5e1; border-radius: 12px; width: 100%; height: 140px; background: white; }
        .hidden { display: none !important; }
        .review-card { min-width: 280px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 1.5rem; border-radius: 1.5rem; }
    </style>
</head>
<body class="pb-32">

    <header class="bg-white pt-8 pb-16 text-center shadow-sm">
        <h1 class="text-3xl font-black text-[#001e50]">××¨×›×– ×©×™×¨×•×ª ×‘×¨×¢×´×</h1>
        <div class="mt-2 flex justify-center items-center gap-2">
            <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
            <span class="text-xs font-bold text-gray-400 tracking-widest uppercase">×‘××¨ ×©×‘×¢</span>
        </div>
    </header>

    <div class="max-w-md mx-auto px-4 -mt-10">
        <div class="bg-white rounded-3xl p-5 shadow-xl border flex justify-between items-center border-gray-100">
            <div class="text-right">
                <p id="liveDate" class="text-[10px] font-black text-blue-900"></p>
                <p id="liveTime" class="text-xl font-black ltr"></p>
            </div>
            <div class="border-r pr-4 text-left">
                <p class="text-[9px] text-gray-400 font-black uppercase">×©×¢×•×ª ×¤×¢×™×œ×•×ª</p>
                <p class="text-xs font-black text-[#001e50] ltr">07:30 - 15:30</p>
                <p class="text-[9px] font-bold text-red-500">×©×™×©×™-×©×‘×ª: ×¡×’×•×¨</p>
            </div>
        </div>
    </div>

    <section class="mt-8 relative px-4">
        <div class="vag-blue rounded-[3rem] pt-12 pb-24 text-center text-white shadow-2xl">
            <h2 class="text-2xl font-black italic mb-1">××•××—×™ VAG</h2>
            <p class="text-xs opacity-70">×¡×™××˜ â€¢ ×¡×§×•×“×” â€¢ ××•×“×™ â€¢ ×¤×•×œ×§×¡×•×•×’×Ÿ</p>
        </div>

        <div class="max-w-md mx-auto grid grid-cols-2 gap-4 px-2 category-grid">
            <div class="bg-white p-6 rounded-[2rem] shadow-lg border border-blue-50 text-center">
                <i class="fas fa-tools text-2xl text-[#001e50] mb-3"></i>
                <p class="text-xs font-black">××›×•× ××•×ª</p>
            </div>
            <div class="bg-white p-6 rounded-[2rem] shadow-lg border border-blue-50 text-center">
                <i class="fas fa-microchip text-2xl text-[#001e50] mb-3"></i>
                <p class="text-xs font-black">×“×™××’× ×•×¡×˜×™×§×”</p>
            </div>
            <div class="bg-white p-6 rounded-[2rem] shadow-lg border border-blue-50 text-center">
                <i class="fas fa-oil-can text-2xl text-[#001e50] mb-3"></i>
                <p class="text-xs font-black">×˜×™×¤×•×œ×™×</p>
            </div>
            <div class="bg-white p-6 rounded-[2rem] shadow-lg border border-blue-50 text-center">
                <i class="fas fa-snowflake text-2xl text-[#001e50] mb-3"></i>
                <p class="text-xs font-black">××™×–×•×’ ××•×•×™×¨</p>
            </div>
            <div class="bg-white p-6 rounded-[2rem] shadow-lg border border-blue-50 text-center">
                <i class="fas fa-car-battery text-2xl text-[#001e50] mb-3"></i>
                <p class="text-xs font-black">×—×©××œ</p>
            </div>
            <div class="bg-white p-6 rounded-[2rem] shadow-lg border border-blue-50 text-center">
                <i class="fas fa-file-contract text-2xl text-[#001e50] mb-3"></i>
                <p class="text-xs font-black">×”×›× ×” ×œ×˜×¡×˜</p>
            </div>
        </div>
    </section>

    <div class="max-w-md mx-auto mt-8 px-6">
        <div class="bg-amber-50 border-r-4 border-amber-400 p-4 rounded-2xl flex items-center gap-4">
            <span class="text-2xl">ğŸ’¡</span>
            <div>
                <p class="text-[10px] font-black text-amber-800 uppercase tracking-tighter">×˜×™×¤ ×™×•××™ ×××•××—×”</p>
                <p id="dailyTip" class="text-xs text-amber-900 font-bold leading-tight"></p>
            </div>
        </div>
    </div>

    <div class="max-w-md mx-auto mt-6 px-6">
        <div class="bg-white rounded-[2.5rem] p-6 shadow-sm border border-blue-100 relative overflow-hidden">
            <div class="flex items-center gap-2 mb-4">
                <div class="w-8 h-8 bg-gradient-to-tr from-blue-600 to-cyan-400 rounded-full flex items-center justify-center text-white text-xs font-black shadow-inner">G</div>
                <h4 class="font-black text-sm text-gray-800">××•××—×” GiminAI (VAG)</h4>
            </div>
            <input id="aiInput" type="text" placeholder="×©××œ ×¢×œ × ×•×¨×ª ××–×”×¨×” ××• ×ª×§×œ×”..." class="w-full bg-gray-50 p-4 rounded-2xl text-xs border-none outline-none focus:ring-2 ring-blue-900/10">
            <button onclick="askAI()" class="w-full mt-3 bg-[#001e50] text-white p-4 rounded-2xl text-xs font-black shadow-lg">×©××œ ××ª ×”××•××—×”</button>
            <p id="aiResponse" class="mt-4 text-[11px] text-gray-600 hidden bg-blue-50/50 p-4 rounded-2xl leading-relaxed italic border border-blue-100"></p>
        </div>
    </div>

    <div class="mt-12 vag-blue py-14 px-6 overflow-hidden">
        <h3 class="text-white text-center font-black mb-8 text-lg">××” ×”×œ×§×•×—×•×ª ××•××¨×™× (Google 5â˜…)</h3>
        <div id="reviewsContainer" class="flex gap-4 overflow-x-auto pb-4 ltr no-scrollbar">
            </div>
    </div>

    <div class="fixed bottom-0 left-0 right-0 p-4 bg-white/90 backdrop-blur-xl border-t z-[100] grid grid-cols-2 gap-3 max-w-md mx-auto shadow-2xl">
        <button onclick="openModal('loginModal')" class="bg-[#001e50] text-white p-4 rounded-[1.5rem] font-black text-sm">×›× ×™×¡×” ×œ××–×•×¨ ××™×©×™</button>
        <button onclick="openModal('regModal')" class="bg-white border-2 border-[#001e50] text-[#001e50] p-4 rounded-[1.5rem] font-black text-sm">×”×¨×©××”</button>
        <a href="tel:086277195" class="bg-green-600 text-white p-3 rounded-xl text-center font-black text-xs col-span-1"><i class="fas fa-phone-alt ml-1"></i> ×—×™×•×’</a>
        <a href="https://waze.com/ul?q=×¤× ×—×¡ ×”×—×•×¦×‘ 35 ×‘××¨ ×©×‘×¢" target="_blank" class="bg-blue-500 text-white p-3 rounded-xl text-center font-black text-xs col-span-1"><i class="fas fa-location-arrow ml-1"></i> × ×™×•×•×˜</a>
    </div>

    <div id="regModal" class="hidden fixed inset-0 bg-black/80 z-[200] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-[3rem] p-8 max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-black text-[#001e50] mb-6 border-b pb-4">×™×¦×™×¨×ª ×—×©×‘×•×Ÿ ×œ×§×•×—</h2>
            <div class="space-y-3">
                <div class="grid grid-cols-2 gap-2">
                    <input id="rFName" type="text" placeholder="×©× ××œ× *" class="p-4 bg-gray-50 rounded-2xl border text-sm" required>
                    <input id="rLName" type="text" placeholder="×©× ××©×¤×—×” *" class="p-4 bg-gray-50 rounded-2xl border text-sm" required>
                </div>
                <input id="rID" type="number" placeholder="×ª×¢×•×“×ª ×–×”×•×ª *" class="w-full p-4 bg-gray-50 rounded-2xl border text-sm ltr" required>
                <input id="rPhone" type="tel" placeholder="×˜×œ×¤×•×Ÿ *" class="w-full p-4 bg-gray-50 rounded-2xl border text-sm ltr" required>
                <input id="rAddr" type="text" placeholder="×›×ª×•×‘×ª *" class="w-full p-4 bg-gray-50 rounded-2xl border text-sm" required>
                <div class="grid grid-cols-2 gap-2">
                    <input id="rModel" type="text" placeholder="×“×’× ×¨×›×‘ *" class="p-4 bg-gray-50 rounded-2xl border text-sm" required>
                    <input id="rYear" type="number" placeholder="×©× ×” *" class="p-4 bg-gray-50 rounded-2xl border text-sm ltr" required>
                </div>
                <input id="rKm" type="number" placeholder="×§×™×œ×•××˜×¨ ×¢×“×›× ×™ *" class="w-full p-4 bg-gray-50 rounded-2xl border text-sm ltr" required>
                <input id="rPlate" type="number" placeholder="××¡×¤×¨ ×¨×›×‘ (×™×©××© ×œ×›× ×™×¡×”) *" class="w-full p-5 bg-blue-50 border-blue-200 rounded-2xl font-black ltr shadow-inner" required>
                <button onclick="handleRegister()" class="w-full bg-[#001e50] text-white p-5 rounded-2xl font-black mt-4 shadow-xl">×”×¨×©× ×›×¢×ª</button>
                <button onclick="closeModal('regModal')" class="w-full text-gray-400 font-bold p-2 text-xs">×¡×’×•×¨</button>
            </div>
        </div>
    </div>

    <div id="loginModal" class="hidden fixed inset-0 bg-black/80 z-[200] flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-[3rem] p-10 text-center shadow-2xl">
            <h2 class="text-2xl font-black text-[#001e50] mb-8 italic">×©×œ×•× ×©×•×‘!</h2>
            <div class="space-y-4">
                <input id="lID" type="number" placeholder="×ª×¢×•×“×ª ×–×”×•×ª" class="w-full p-5 bg-gray-50 rounded-2xl ltr text-center font-bold border">
                <input id="lPlate" type="number" placeholder="××¡×¤×¨ ×¨×›×‘" class="w-full p-5 bg-gray-50 rounded-2xl ltr text-center font-bold border">
                <button onclick="handleLogin()" class="w-full bg-[#001e50] text-white p-5 rounded-2xl font-black shadow-lg">×›× ×™×¡×” ×œ××–×•×¨ ××™×©×™</button>
                <button onclick="closeModal('loginModal')" class="text-gray-400 font-bold text-xs mt-4">×—×–×•×¨ ×œ×“×£ ×”×‘×™×ª</button>
            </div>
        </div>
    </div>

    <div id="personalArea" class="hidden fixed inset-0 bg-[#f8fafc] z-[300] overflow-y-auto pb-32">
        <nav class="bg-white p-6 border-b flex justify-between items-center sticky top-0 z-50 shadow-sm">
            <div>
                <h2 id="uName" class="font-black text-[#001e50] italic">×©×œ×•×, ×œ×§×•×—</h2>
                <p id="uCarInfo" class="text-[10px] font-bold text-gray-400 ltr"></p>
            </div>
            <button onclick="logout()" class="text-red-500 bg-red-50 p-3 rounded-2xl"><i class="fas fa-sign-out-alt"></i></button>
        </nav>

        <main class="p-6 space-y-6 max-w-md mx-auto">
            
            <div id="smartBanner" class="hidden bg-[#001e50] text-white p-5 rounded-[2rem] shadow-xl flex items-center gap-4 animate-pulse">
                <div class="bg-white/20 p-3 rounded-full"><i class="fas fa-bell text-yellow-400"></i></div>
                <p id="bannerMsg" class="text-[11px] font-black leading-tight"></p>
            </div>

            <div id="quoteSection" class="hidden bg-white rounded-[2.5rem] p-7 shadow-xl border-2 border-amber-200">
                <div class="flex justify-between items-center mb-5">
                    <h4 class="font-black text-amber-600 text-sm">×”×¦×¢×ª ××—×™×¨ ×œ××™×©×•×¨</h4>
                    <button onclick="downloadQuote()" class="text-blue-600 text-[10px] font-bold underline">×”×•×¨×“ PDF</button>
                </div>
                <div id="quoteBody" class="text-[11px] space-y-3 mb-6 bg-slate-50 p-4 rounded-2xl border"></div>
                <p class="text-[9px] text-gray-400 text-center font-bold mb-2">× × ×œ×—×ª×•× ×‘××¡×’×¨×ª ×œ××™×©×•×¨ ×”×¢×‘×•×“×”:</p>
                <canvas id="sigPad"></canvas>
                <div class="grid grid-cols-2 gap-3 mt-4">
                    <button onclick="sigPad.clear()" class="bg-gray-100 p-3 rounded-xl text-xs font-bold">× ×§×”</button>
                    <button onclick="approveQuote()" class="bg-green-600 text-white p-3 rounded-xl text-xs font-black shadow-lg">××©×¨ ×•×—×ª×•×</button>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white p-5 rounded-3xl shadow-sm border border-gray-100 text-center">
                    <p class="text-[9px] text-gray-400 font-black mb-1">×˜×¡×˜ ×”×‘×</p>
                    <p id="pNextTest" class="text-xs font-black text-[#001e50] ltr">--/--/--</p>
                </div>
                <div class="bg-white p-5 rounded-3xl shadow-sm border border-gray-100 text-center">
                    <p class="text-[9px] text-gray-400 font-black mb-1">×˜×™×¤×•×œ ×”×‘×</p>
                    <p id="pNextServ" class="text-xs font-black text-[#001e50] ltr">--/--/--</p>
                </div>
            </div>

            <div class="bg-white rounded-[2.5rem] p-7 shadow-sm border border-gray-100">
                <h4 class="font-black text-sm mb-5 italic"><i class="fas fa-calendar-alt ml-2 text-blue-900"></i>×§×‘×™×¢×ª ×ª×•×¨ ×œ××•×¡×š</h4>
                <div class="space-y-4">
                    <input id="appDate" type="date" class="w-full p-4 bg-gray-50 rounded-2xl text-xs ltr border-none">
                    <select id="appTime" class="w-full p-4 bg-gray-50 rounded-2xl text-xs ltr border-none font-bold text-[#001e50]">
                        <option value="07:30">07:30</option><option value="08:30">08:30</option>
                        <option value="10:00">10:00</option><option value="12:00">12:00</option>
                        <option value="14:00">14:00</option><option value="15:00">15:00</option>
                    </select>
                    <button onclick="bookAppt()" class="w-full bg-[#001e50] text-white p-4 rounded-2xl font-black text-xs shadow-lg">×©×œ×— ×‘×§×©×ª ×ª×•×¨</button>
                </div>
                <div id="activeAppts" class="mt-4 space-y-2"></div>
            </div>

            <div class="bg-white rounded-[2.5rem] p-7 shadow-sm border border-gray-100">
                <h4 class="font-black text-sm mb-4">×ª×™×‘×ª ×”×•×“×¢×•×ª</h4>
                <div id="inbox" class="space-y-3 text-[11px] text-gray-500 italic">××™×Ÿ ×”×•×“×¢×•×ª ×—×“×©×•×ª ××”××•×¡×š.</div>
            </div>

            <div class="bg-white rounded-[2.5rem] p-7 shadow-sm border border-gray-100">
                <h4 class="font-black text-sm mb-6 underline decoration-[#001e50] underline-offset-8">×”×™×¡×˜×•×¨×™×™×ª ×¨×›×‘ (×©× ×ª×™×™× ××—×•×¨×”)</h4>
                <div class="flex gap-4 overflow-x-auto border-b mb-4 no-scrollbar">
                    <button onclick="switchTab('h-quotes', this)" class="tab-btn active pb-2 text-[10px] font-black whitespace-nowrap">×”×¦×¢×•×ª ××—×™×¨</button>
                    <button onclick="switchTab('h-serv', this)" class="tab-btn pb-2 text-[10px] font-black whitespace-nowrap">×˜×™×¤×•×œ×™×</button>
                    <button onclick="switchTab('h-test', this)" class="tab-btn pb-2 text-[10px] font-black whitespace-nowrap">×˜×¡×˜×™×</button>
                    <button onclick="switchTab('h-check', this)" class="tab-btn pb-2 text-[10px] font-black whitespace-nowrap">×‘×™×§×•×¨×•×ª</button>
                </div>
                <div id="h-quotes" class="tab-content text-[11px] space-y-3"></div>
                <div id="h-serv" class="tab-content hidden text-[11px] space-y-3"></div>
                <div id="h-test" class="tab-content hidden text-[11px] space-y-3"></div>
                <div id="h-check" class="tab-content hidden text-[11px] space-y-3"></div>
            </div>
        </main>
    </div>

    <script>
        // --- 1. CONFIG & FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyDD7YAdTePRWYjwBbmy3gLRYd_OLDwpTL8",
            authDomain: "baram-vag-45e12.firebaseapp.com",
            projectId: "baram-vag-45e12",
            storageBucket: "baram-vag-45e12.firebasestorage.app",
            messagingSenderId: "761383355945",
            appId: "1:761383355945:web:552554b5a6b9fe5e78be38"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- 2. LIVE UI (Date, Time, Reviews) ---
        function updateUI() {
            const now = new Date();
            document.getElementById('liveDate').innerText = now.toLocaleDateString('he-IL', {weekday:'long', day:'numeric', month:'numeric'});
            document.getElementById('liveTime').innerText = now.toLocaleTimeString('he-IL', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
        }
        setInterval(updateUI, 1000); updateUI();

        const tips = ["×‘×“×™×§×ª ×©××Ÿ ×¤×¢× ×‘×©×‘×•×¢×™×™× ×©×•××¨×ª ×¢×œ ×”-Turbo ×©×œ ×”-VAG ×©×œ×š.", "××œ ×ª×ª×¢×œ× ×× ×•×¨×ª EPC - ×”×™× ×“×•×¨×©×ª ×¡×¨×™×§×ª ODIS ××§×¦×•×¢×™×ª.", "×”×—×œ×¤×ª × ×•×–×œ ×§×™×¨×•×¨ ××§×•×¨×™ G12/G13 ×§×¨×™×˜×™×ª ×œ×¨××© ×”×× ×•×¢."];
        document.getElementById('dailyTip').innerText = tips[new Date().getDate() % tips.length];

        function loadReviews() {
            const cont = document.getElementById('reviewsContainer');
            const texts = ["×©×™×¨×•×ª ×¤×¦×¦×” ×œ××•×“×™ ×©×œ×™!", "××§×¦×•×¢× ×™× ×‘×¨××•×ª, ×”×›×™ ×˜×•×‘×™× ×‘×‘××¨ ×©×‘×¢.", "×¨×§ ×‘×¨×¢×´× ×× ×™ ××˜×¤×œ ×‘×’×•×œ×£.", "×××™× ×•×ª ×•×“×™×•×§ ×©×œ ×©×¢×•×Ÿ ×©×•×•×™×¦×¨×™.", "××•××—×™× ×××™×ª×™×™× ×œ×›×œ ×§×‘×•×¦×ª VAG."];
            for(let i=0; i<10; i++) {
                cont.innerHTML += `<div class="review-card text-white text-right"><div class="text-yellow-400 text-[8px] mb-2">${'<i class="fas fa-star"></i>'.repeat(5)}</div><p class="text-[11px] italic">"${texts[i%5]}"</p><p class="mt-4 text-[9px] font-bold opacity-40">- ×œ×§×•×— Google</p></div>`;
            }
        }
        loadReviews();

        // --- 3. GiminAI EXPERT ---
        function askAI() {
            const q = document.getElementById('aiInput').value.toLowerCase();
            const res = document.getElementById('aiResponse');
            res.classList.remove('hidden');
            if(q.includes('vag') || q.includes('×¤×•×œ×§×¡') || q.includes('××•×“×™') || q.includes('×¡×™××˜') || q.includes('×¡×§×•×“×”')) {
                res.innerText = "×©×œ×•×, ×× ×™ GiminAI. ×¢×‘×•×¨ ×¨×›×‘ VAG, ××” ×©×ª×™××¨×ª ×¢×©×•×™ ×œ× ×‘×•×¢ ××ª×§×œ×ª ×—×™×™×©×Ÿ ××• ×¦×•×¨×š ×‘×¢×“×›×•×Ÿ ×ª×•×›× ×” ×‘××—×©×‘ ×”×’×™×¨. ×× ×™ ×××œ×™×¥ ×œ×”×’×™×¢ ××œ×™× ×• ×œ×¡×¨×™×§×” ××§×•×¨×™×ª.";
            } else {
                res.innerText = "××¦×˜×¢×¨, ×× ×™ ××•××—×” ××•×¡××š ×¨×§ ×œ×¨×›×‘×™ ×§×‘×•×¦×ª VAG. ×©××œ ××•×ª×™ ×¢×œ×™×”×!";
            }
        }

        // --- 4. AUTH & DASHBOARD ---
        async function handleRegister() {
            const plate = document.getElementById('rPlate').value;
            const user = {
                fName: document.getElementById('rFName').value,
                lName: document.getElementById('rLName').value,
                id: document.getElementById('rID').value,
                phone: document.getElementById('rPhone').value,
                addr: document.getElementById('rAddr').value,
                model: document.getElementById('rModel').value,
                year: document.getElementById('rYear').value,
                km: document.getElementById('rKm').value,
                plate: plate,
                history: { quotes:[], services:[], tests:[], checks:[] }
            };
            if(!plate || !user.id) return alert("××œ× ××ª ×›×œ ×©×“×•×ª ×”×—×•×‘×”");
            await db.collection("customers").doc(plate).set(user);
            alert("× ×¨×©××ª ×‘×”×¦×œ×—×”!"); location.reload();
        }

        async function handleLogin() {
            const id = document.getElementById('lID').value;
            const plate = document.getElementById('lPlate').value;
            const doc = await db.collection("customers").doc(plate).get();
            if(doc.exists && doc.data().id === id) {
                localStorage.setItem('uPlate', plate);
                initDashboard(doc.data());
            } else alert("×¤×¨×˜×™× ×©×’×•×™×™×!");
        }

        let sigPad;
        function initDashboard(user) {
            document.getElementById('personalArea').classList.remove('hidden');
            document.getElementById('uName').innerText = `×©×œ×•×, ${user.fName}`;
            document.getElementById('uCarInfo').innerText = `${user.model} | ${user.plate}`;
            
            sigPad = new SignaturePad(document.getElementById('sigPad'));
            checkSeasonAlert(user);
            renderHistory(user.history);
            loadAppointments(user.plate);

            const pending = (user.history.quotes || []).find(q => !q.signed);
            if(pending) {
                document.getElementById('quoteSection').classList.remove('hidden');
                document.getElementById('quoteBody').innerHTML = `<b>${pending.title}</b><p>${pending.desc}</p><p class="text-blue-900 font-black">×¡×”"×›: â‚ª${pending.total}</p>`;
                window.activeQuote = pending;
            }
        }

        function checkSeasonAlert(user) {
            const month = new Date().getMonth() + 1;
            const banner = document.getElementById('smartBanner');
            const msg = document.getElementById('bannerMsg');
            banner.classList.remove('hidden');
            if(month >= 11 || month <= 2) msg.innerText = "×”×—×•×¨×£ ×‘×©×™××•! ×‘×•× ×œ×‘×“×™×§×ª ×—×•×¨×£ ×—×™× × (×‘×œ××™×, ××’×‘×™× ×•××•×¨×•×ª) ×‘×¨×¢×´×.";
            else if(month >= 6 && month <= 8) msg.innerText = "×§×™×¥ ×œ×•×”×˜ ×‘×‘××¨ ×©×‘×¢! ××•××œ×¥ ×œ×•×•×“× ×ª×§×™× ×•×ª ××–×’×Ÿ ×•× ×•×–×œ ×§×™×¨×•×¨ G13.";
            else msg.innerText = "×–××Ÿ ×œ×˜×™×¤×•×œ ×ª×§×•×¤×ª×™? ×‘×“×•×§ ××ª ×œ×©×•× ×™×ª ×”×”×™×¡×˜×•×¨×™×” ×©×œ×š ×œ××˜×”.";
        }

        function renderHistory(hist) {
            const twoYearsAgo = new Date(); twoYearsAgo.setFullYear(twoYearsAgo.getFullYear() - 2);
            const filter = (arr) => (arr || []).filter(i => new Date(i.date) > twoYearsAgo);

            const map = (arr, elId) => {
                const data = filter(arr);
                document.getElementById(elId).innerHTML = data.length ? data.map(i => `<div class="p-3 bg-gray-50 rounded-xl border flex justify-between"><span>${i.desc}</span><span class="ltr font-bold">${i.date}</span></div>`).join('') : "××™×Ÿ × ×ª×•× ×™×.";
            };

            map(hist.quotes, 'h-quotes');
            map(hist.services, 'h-serv');
            map(hist.tests, 'h-test');
            map(hist.checks, 'h-check');
        }

        async function approveQuote() {
            if(sigPad.isEmpty()) return alert("×—×•×‘×” ×œ×—×ª×•× ×œ××™×©×•×¨!");
            const plate = localStorage.getItem('uPlate');
            // Logic to update Firestore quote as signed...
            alert("×”×”×¦×¢×” ××•×©×¨×” ×•× ×©×œ×—×” ×œ× ×™×”×•×œ!");
            location.reload();
        }

        function switchTab(tabId, btn) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.remove('hidden');
            btn.classList.add('active');
        }

        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function logout() { localStorage.clear(); location.reload(); }
    </script>
</body>
</html>
