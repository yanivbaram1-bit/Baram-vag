<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>מרכז שירות ברע״מ | VAG Specialist</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>

<style>
body{font-family:Arial;background:#f4f7f9}
.vag{background:#001e50}
.hidden{display:none}
</style>
</head>

<body class="pb-24">

<!-- HEADER -->
<header class="bg-white text-center py-8 shadow">
<div class="vag text-white inline-block px-8 py-3 rounded-2xl font-bold text-3xl mb-2">VAG</div>
<h1 class="text-2xl font-bold text-blue-900">מרכז שירות ברע״מ</h1>
<p class="text-gray-500">באר שבע</p>
</header>

<!-- HERO -->
<section class="vag text-white text-center py-10">
<h2 class="text-xl font-bold mb-2">מומחי VAG</h2>
<p>סיאט • סקודה • אודי • פולקסווגן</p>
</section>

<!-- ACTION BUTTONS -->
<div class="max-w-md mx-auto grid grid-cols-2 gap-4 px-6 mt-8">

<button onclick="openModal('loginModal')" class="bg-blue-900 text-white p-4 rounded-2xl font-bold shadow">
כניסה
</button>

<button onclick="openModal('regModal')" class="bg-white border-2 border-blue-900 text-blue-900 p-4 rounded-2xl font-bold">
הרשמה
</button>

</div>

<!-- CALL + WAZE -->
<div class="fixed bottom-6 left-0 right-0 px-6 flex gap-3 max-w-md mx-auto">

<a href="tel:086277195" class="flex-1 bg-green-500 text-white p-4 rounded-2xl text-center font-bold">
חיוג למוסך
</a>

<a href="https://waze.com/ul?q=פנחס החוצב 35 באר שבע" target="_blank"
class="flex-1 bg-blue-600 text-white p-4 rounded-2xl text-center font-bold">
ניווט Waze
</a>

</div>

<!-- REGISTER -->
<div id="regModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center">

<div class="bg-white w-full max-w-md p-6 rounded-3xl">

<h2 class="text-xl font-bold text-blue-900 mb-4">פתיחת כרטיס לקוח</h2>

<input id="rName" placeholder="שם מלא" class="w-full p-3 bg-gray-100 rounded mb-2">
<input id="rEmail" placeholder="אימייל" class="w-full p-3 bg-gray-100 rounded mb-2">
<input id="rPlate" placeholder="מספר רכב" class="w-full p-3 bg-gray-100 rounded mb-4">

<button onclick="handleRegister()" class="w-full bg-blue-900 text-white p-4 rounded-xl font-bold">
הרשמה
</button>

<button onclick="closeModal('regModal')" class="w-full mt-3 text-gray-400">
ביטול
</button>

</div>
</div>

<!-- LOGIN -->
<div id="loginModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center">

<div class="bg-white w-full max-w-sm p-6 rounded-3xl text-center">

<h2 class="text-xl font-bold text-blue-900 mb-4">כניסה עם קוד אימייל</h2>

<input id="lEmail" placeholder="אימייל" class="w-full p-3 bg-gray-100 rounded mb-4">

<button onclick="sendCode()" class="w-full bg-blue-900 text-white p-4 rounded-xl font-bold">
שלח קוד
</button>

<input id="lCode" placeholder="קוד שקיבלת" class="w-full p-3 bg-gray-100 rounded mt-4">

<button onclick="login()" class="w-full bg-green-600 text-white p-4 rounded-xl font-bold mt-3">
כניסה
</button>

<button onclick="closeModal('loginModal')" class="w-full mt-3 text-gray-400">
ביטול
</button>

</div>
</div>

<!-- PERSONAL AREA -->
<div id="personal" class="hidden fixed inset-0 bg-white overflow-y-auto">

<header class="bg-white p-4 shadow flex justify-between">
<h2 id="welcome" class="font-bold text-blue-900"></h2>
<button onclick="logout()" class="text-red-500">יציאה</button>
</header>

<main class="p-6 space-y-6 max-w-md mx-auto">

<!-- BOOK APPOINTMENT -->
<div class="bg-gray-50 p-4 rounded-2xl">

<h3 class="font-bold mb-2">קביעת תור</h3>

<input id="appDate" type="date" class="w-full p-3 bg-white rounded mb-2">
<input id="appTime" type="time" class="w-full p-3 bg-white rounded mb-3">

<button onclick="book()" class="w-full bg-blue-900 text-white p-4 rounded-xl font-bold">
שלח בקשה לתור
</button>

</div>

<!-- ACTIVE APPOINTMENTS -->
<div class="bg-gray-50 p-4 rounded-2xl">

<h3 class="font-bold mb-2">התורים שלי</h3>
<div id="apptList"></div>

</div>

</main>
</div>

<script>

// FIREBASE CONFIG
const firebaseConfig = {
apiKey:"YOUR_KEY",
authDomain:"YOUR_DOMAIN",
projectId:"YOUR_PROJECT"
}

firebase.initializeApp(firebaseConfig)
const db = firebase.firestore()

// MODALS
function openModal(id){document.getElementById(id).classList.remove('hidden')}
function closeModal(id){document.getElementById(id).classList.add('hidden')}

// REGISTER
async function handleRegister(){

const data={
name:rName.value,
email:rEmail.value,
plate:rPlate.value
}

await db.collection("customers").doc(data.email).set(data)

alert("נרשמת בהצלחה")
closeModal('regModal')
}

// EMAIL CODE (SIMULATED)
let tempCode=""

function sendCode(){

tempCode=Math.floor(100000+Math.random()*900000).toString()

alert("קוד כניסה: "+tempCode) // כאן בעתיד מחליפים לשליחה אמיתית

}

// LOGIN
async function login(){

if(lCode.value!==tempCode)return alert("קוד שגוי")

const doc=await db.collection("customers").doc(lEmail.value).get()

if(!doc.exists)return alert("לא נמצא משתמש")

localStorage.setItem("user",lEmail.value)

init(doc.data())
}

// INIT PERSONAL
function init(user){

personal.classList.remove('hidden')
welcome.innerText="שלום "+user.name

loadAppointments()

}

// BOOK APPOINTMENT
async function book(){

const user=localStorage.getItem("user")

await db.collection("appointments").add({
user,
date:appDate.value,
time:appTime.value,
status:"pending"
})

alert("בקשה נשלחה")
loadAppointments()
}

// LOAD APPOINTMENTS
function loadAppointments(){

const user=localStorage.getItem("user")

db.collection("appointments").where("user","==",user)
.onSnapshot(snap=>{

apptList.innerHTML=""

snap.forEach(d=>{
const a=d.data()
apptList.innerHTML+=`
<div class="bg-white p-3 rounded mb-2">
${a.date} ${a.time} - ${a.status==="pending"?"ממתין לאישור":"מאושר"}
</div>`
})

})

}

// LOGOUT
function logout(){
localStorage.clear()
location.reload()
}

</script>

</body>
</html>