<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>מרכז שירות ברע״מ | VAG Specialist</title>

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>

<style>
body { font-family: Assistant, sans-serif; background:#f4f7f9; }
.vag-blue { background:#001e50; }
.hidden { display:none!important; }
.ltr { direction:ltr; }
</style>
</head>

<body class="pb-24">

<header class="bg-white pt-8 pb-12 text-center border-b">
<div class="vag-blue text-white inline-block px-8 py-3 rounded-2xl font-black text-3xl mb-2">VAG</div>
<h1 class="text-3xl font-black text-[#001e50]">מרכז שירות ברע״מ</h1>
<p class="text-gray-500 font-bold">באר שבע</p>
</header>

<!-- שעות + שעון -->
<div class="max-w-md mx-auto px-4 -mt-6">
<div class="bg-white rounded-2xl p-4 shadow flex justify-between items-center">
<div>
<p id="liveDate" class="text-xs font-bold"></p>
<p id="liveTime" class="text-lg font-black ltr"></p>
</div>
<div>
<p class="text-xs text-gray-400">שעות פעילות</p>
<p class="font-bold text-green-600">08:00-17:00</p>
</div>
</div>
</div>

<!-- כפתורים -->
<div class="grid grid-cols-2 gap-4 px-6 mt-10 max-w-md mx-auto">
<button onclick="openModal('loginModal')" class="bg-blue-900 text-white p-4 rounded-2xl font-black">כניסה</button>
<button onclick="openModal('regModal')" class="bg-white border-2 border-blue-900 text-blue-900 p-4 rounded-2xl font-black">הרשמה</button>
</div>

<!-- חיוג + ניווט -->
<div class="fixed bottom-6 left-0 right-0 px-6 flex gap-3 max-w-md mx-auto">
<a href="tel:086277195" class="flex-1 bg-green-500 text-white p-4 rounded-2xl text-center font-black">
<i class="fas fa-phone"></i> חיוג
</a>

<a href="https://waze.com/ul?q=%D7%A4%D7%A0%D7%97%D7%A1%20%D7%94%D7%97%D7%95%D7%A6%D7%91%2035%20%D7%91%D7%90%D7%A8%20%D7%A9%D7%91%D7%A2"
target="_blank"
class="flex-1 bg-blue-600 text-white p-4 rounded-2xl text-center font-black">
<i class="fas fa-location-arrow"></i> ניווט
</a>
</div>

<!-- הרשמה -->
<div id="regModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center p-4">
<div class="bg-white w-full max-w-md rounded-3xl p-6">

<h2 class="text-xl font-black mb-4">פתיחת כרטיס לקוח</h2>

<input id="rName" type="text" placeholder="שם מלא"
class="w-full p-3 bg-gray-50 rounded-xl mb-2">

<input id="rID" type="text" inputmode="numeric"
placeholder="תעודת זהות (חובה)"
class="w-full p-3 bg-gray-50 rounded-xl mb-2 ltr">

<input id="rPhone" type="tel"
placeholder="טלפון"
class="w-full p-3 bg-gray-50 rounded-xl mb-2 ltr">

<input id="rModel" type="text"
placeholder="דגם רכב"
class="w-full p-3 bg-gray-50 rounded-xl mb-2">

<input id="rPlate" type="text" inputmode="numeric"
placeholder="מספר רכב (חובה)"
class="w-full p-3 bg-blue-50 rounded-xl mb-4 ltr font-bold">

<button onclick="handleRegister()"
class="w-full bg-blue-900 text-white p-4 rounded-2xl font-black">
הרשמה
</button>

</div>
</div>

<!-- כניסה -->
<div id="loginModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center p-4">
<div class="bg-white w-full max-w-sm rounded-3xl p-6 text-center">

<h2 class="text-xl font-black mb-4">כניסה</h2>

<input id="lID" type="text" inputmode="numeric"
placeholder="תעודת זהות"
class="w-full p-3 bg-gray-50 rounded-xl mb-2 ltr text-center">

<input id="lPlate" type="text" inputmode="numeric"
placeholder="מספר רכב"
class="w-full p-3 bg-gray-50 rounded-xl mb-4 ltr text-center">

<button onclick="handleLogin()"
class="w-full bg-blue-900 text-white p-4 rounded-2xl font-black">
כניסה
</button>

</div>
</div>

<!-- אזור אישי -->
<div id="personalArea" class="hidden fixed inset-0 bg-white overflow-y-auto pb-24">

<header class="p-6 border-b flex justify-between">
<div>
<h2 id="welcomeName" class="font-black text-blue-900 text-xl"></h2>
<p id="carInfo" class="text-xs text-gray-400 ltr"></p>
</div>

<button onclick="logout()" class="text-red-500">
<i class="fas fa-power-off"></i>
</button>
</header>

<main class="p-6 max-w-md mx-auto space-y-6">

<!-- קביעת תור -->
<div class="bg-white p-4 rounded-2xl shadow">

<h4 class="font-black mb-3">קביעת תור</h4>

<input id="appDate" type="date"
class="w-full p-3 bg-gray-50 rounded-xl mb-2">

<select id="appTime"
class="w-full p-3 bg-gray-50 rounded-xl mb-3">
<option>08:00</option>
<option>09:00</option>
<option>10:00</option>
<option>11:00</option>
<option>12:00</option>
<option>13:00</option>
<option>14:00</option>
<option>15:00</option>
<option>16:00</option>
</select>

<button onclick="bookAppt()"
class="w-full bg-blue-900 text-white p-3 rounded-xl font-black">
אשר תור
</button>

<div id="activeAppts" class="mt-3 space-y-2"></div>

</div>

<!-- הצעת מחיר -->
<div id="quoteArea" class="hidden bg-amber-50 p-4 rounded-2xl">

<h4 class="font-black mb-2">הצעת מחיר</h4>
<p id="quoteContent" class="text-sm mb-3"></p>

<canvas id="sigPad" class="w-full h-32 bg-white rounded-xl"></canvas>

<button onclick="approveQuote()"
class="w-full bg-amber-600 text-white p-3 rounded-xl font-black mt-3">
אישור חתום
</button>

</div>

</main>
</div>

<script>
const firebaseConfig = {
apiKey: "YOUR_KEY",
projectId: "baram-vag-45e12"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();


// שעון
setInterval(()=>{
const n=new Date();
liveDate.textContent=n.toLocaleDateString('he-IL');
liveTime.textContent=n.toLocaleTimeString('he-IL');
},1000);


// הרשמה
async function handleRegister(){

const plate=rPlate.value.trim();
const id=rID.value.trim();

if(!plate||!id) return alert("שדות חובה חסרים");

await db.collection("customers").doc(plate).set({
name:rName.value,
id,
phone:rPhone.value,
model:rModel.value,
plate,
quotes:[],
messages:[]
});

alert("נרשמת בהצלחה");
closeModal('regModal');
}


// כניסה
async function handleLogin(){

const id=lID.value.trim();
const plate=lPlate.value.trim();

const doc=await db.collection("customers").doc(plate).get();

if(doc.exists && doc.data().id===id){

localStorage.setItem('plate',plate);
initPersonalArea(doc.data());

}else alert("פרטים שגויים");
}


// אזור אישי
let signaturePad;

function initPersonalArea(user){

personalArea.classList.remove('hidden');

welcomeName.textContent="שלום, "+user.name;
carInfo.textContent=user.model+" | "+user.plate;

const canvas=document.getElementById('sigPad');

function resize(){
const ratio=window.devicePixelRatio||1;
canvas.width=canvas.offsetWidth*ratio;
canvas.height=canvas.offsetHeight*ratio;
canvas.getContext("2d").scale(ratio,ratio);
}
resize();
window.addEventListener("resize",resize);

signaturePad=new SignaturePad(canvas);

loadActiveAppts(user.plate);
checkQuotes(user.quotes||[]);
}


// קביעת תור
async function bookAppt(){

const plate=localStorage.getItem('plate');
const date=appDate.value;
const time=appTime.value;

if(!date) return alert("בחר תאריך");

await db.collection("appointments").add({plate,date,time});
}


// הצגת תורים
function loadActiveAppts(plate){

db.collection("appointments")
.where("plate","==",plate)
.onSnapshot(snap=>{

activeAppts.innerHTML="";

snap.forEach(d=>{
const a=d.data();

activeAppts.innerHTML+=`
<div class="bg-blue-50 p-2 rounded-xl flex justify-between">
<span>${a.date} ${a.time}</span>
<button onclick="cancelAppt('${d.id}')" class="text-red-500">ביטול</button>
</div>`;
});
});
}


async function cancelAppt(id){
await db.collection("appointments").doc(id).delete();
}


// הצעות מחיר
function checkQuotes(quotes){

const q=quotes.find(x=>!x.signed);
if(!q) return;

quoteArea.classList.remove('hidden');
quoteContent.textContent=q.title+" | "+q.total;
window.activeQuote=q.id;
}


async function approveQuote(){

if(signaturePad.isEmpty())
return alert("חתום לפני אישור");

alert("נשלח למוסך");
quoteArea.classList.add('hidden');
}


// כללי
function openModal(id){document.getElementById(id).classList.remove('hidden')}
function closeModal(id){document.getElementById(id).classList.add('hidden')}
function logout(){localStorage.clear();location.reload()}

</script>
</body>
</html>