<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>מרכז שירות ברע״מ | VAG Specialist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700;800&display=swap');
        body { font-family: 'Assistant', sans-serif; background-color: #f1f5f9; margin: 0; }
        .hero-bg, .reviews-section { background: linear-gradient(135deg, #0f172a 0%, #1e40af 100%); }
        header { display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; padding: 10px 15px; background: white; border-bottom: 2px solid #e2e8f0; position: sticky; top: 0; z-index: 100; }
        .service-box { background: white; border-radius: 15px; padding: 10px; text-align: center; border: 1px solid #cbd5e1; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .service-box i { font-size: 1.2rem; color: #2563eb; margin-bottom: 4px; display: block; }
        .card { background: white; border-radius: 20px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; }
        .review-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 12px; color: white; margin-bottom: 10px; font-size: 12px; }
        .tip-box { background: #fefce8; border: 1px dashed #facc15; border-radius: 12px; padding: 10px; margin-bottom: 15px; text-align: center; }
        .hidden { display: none; }
        input { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 10px; margin-bottom: 8px; font-size: 14px; }
        .status-badge { font-size: 10px; padding: 2px 8px; border-radius: 10px; font-weight: bold; }
        .status-open { background: #dcfce7; color: #166534; }
        .status-closed { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>

    <header>
        <div id="headerLeft" class="text-[11px] font-bold text-blue-600">
            <span id="liveTime"></span><br>
            <span id="userNameDisplay"></span>
        </div>
        <div class="text-center">
            <h1 class="text-lg font-black text-blue-900 leading-tight">מרכז שירות ברע״מ</h1>
            <span id="shopStatus" class="status-badge">טוען...</span>
        </div>
        <div class="text-left">
            <button id="logoutBtn" onclick="location.reload()" class="hidden text-red-600 text-[10px] font-black bg-red-50 px-2 py-1 rounded-full border border-red-200">יציאה <i class="fas fa-sign-out-alt"></i></button>
        </div>
    </header>

    <div id="homePage">
        <section class="hero-bg pt-4 pb-12 px-6 text-center text-white">
            <p id="liveDate" class="text-[10px] opacity-70 mb-2"></p>
            <h2 class="text-xl font-bold mb-1 italic uppercase">VAG Specialist Center</h2>
            <div class="grid grid-cols-3 gap-2 max-w-sm mx-auto mt-4">
                <a href="tel:086277195" class="bg-white text-blue-900 rounded-lg p-2 text-[11px] font-bold shadow-lg"><i class="fas fa-phone"></i> חיוג</a>
                <a href="https://waze.com/ul?q=פנחס החוצב 35 באר שבע" class="bg-white text-blue-900 rounded-lg p-2 text-[11px] font-bold shadow-lg"><i class="fab fa-waze text-blue-400"></i> ניווט</a>
                <a href="https://wa.me/972505858750" class="bg-white text-blue-900 rounded-lg p-2 text-[11px] font-bold shadow-lg"><i class="fab fa-whatsapp text-green-500"></i> הודעה</a>
            </div>
        </section>

        <div class="max-w-md mx-auto px-4 -mt-6 relative z-10">
            <div class="tip-box shadow-sm">
                <p class="text-[10px] font-bold text-yellow-700 uppercase"><i class="fas fa-lightbulb"></i> טיפ יומי מברע״מ:</p>
                <p id="dailyTip" class="text-xs font-semibold text-slate-800"></p>
            </div>

            <div id="authButtons" class="grid grid-cols-2 gap-3 mb-6">
                <button onclick="showPage('loginPage')" class="card p-4 text-center border-b-4 border-blue-600 font-bold text-xs"><i class="fas fa-user-lock mb-1 block text-blue-600 text-lg"></i>אזור אישי</button>
                <button onclick="showPage('registerPage')" class="card p-4 text-center border-b-4 border-slate-700 font-bold text-xs"><i class="fas fa-id-card mb-1 block text-slate-700 text-lg"></i>רישום לקוח</button>
            </div>

            <div class="card p-3 mb-6 text-center">
                <h4 class="text-[10px] font-black text-slate-400 uppercase mb-2">שעות פעילות</h4>
                <div class="flex flex-col gap-1 text-[12px] font-bold text-slate-700">
                    <div><i class="far fa-clock ml-1 text-blue-500"></i> א׳ - ה׳: 07:30 - 15:30</div>
                    <div class="text-red-500"><i class="fas fa-ban ml-1"></i> ו׳ - ש׳: סגור</div>
                </div>
            </div>

            <div class="grid grid-cols-3 gap-2 mb-8">
                <div class="service-box"><i class="fas fa-microchip"></i><p class="text-[9px] font-bold">אבחון</p></div>
                <div class="service-box"><i class="fas fa-oil-can"></i><p class="text-[9px] font-bold">טיפולים</p></div>
                <div class="service-box"><i class="fas fa-gear"></i><p class="text-[9px] font-bold">גירים</p></div>
                <div class="service-box"><i class="fas fa-bolt"></i><p class="text-[9px] font-bold">חשמל</p></div>
                <div class="service-box"><i class="fas fa-life-ring"></i><p class="text-[9px] font-bold">בלמים</p></div>
                <div class="service-box"><i class="fas fa-snowflake"></i><p class="text-[9px] font-bold">מיזוג</p></div>
            </div>

            <div class="card p-5 mb-10 border-r-4 border-blue-500">
                <h3 class="font-bold text-sm mb-3"><i class="fas fa-robot text-blue-600"></i> אבחון AI ברע״מ</h3>
                <input type="text" id="aiInput" placeholder="מה התקלה ברכב שלך?">
                <button onclick="askExpertAI()" id="aiBtn" class="w-full bg-blue-900 text-white py-3 rounded-xl font-bold text-xs uppercase shadow-md">שלח לאבחון</button>
                <div id="aiResponse" class="hidden mt-4 p-4 bg-blue-50 rounded-xl text-xs leading-relaxed border-r-2 border-blue-200"></div>
            </div>
        </div>

        <section class="reviews-section py-10 px-6">
            <h3 class="text-white text-center font-black text-lg mb-6 tracking-widest uppercase">ביקורות גוגל (5.0 ⭐)</h3>
            <div id="reviewsContainer" class="max-w-md mx-auto"></div>
        </section>
    </div>

    <div id="registerPage" class="hidden p-5 max-w-md mx-auto">
        <button onclick="showPage('homePage')" class="mb-4 text-blue-900 font-bold"><i class="fas fa-chevron-right ml-1"></i> חזרה</button>
        <div class="card p-6">
            <h2 class="text-xl font-black mb-4 text-blue-900 border-b pb-2 text-center">פתיחת כרטיס לקוח - ברע״מ</h2>
            <div class="space-y-1">
                <input type="text" id="regFirst" placeholder="שם פרטי">
                <input type="text" id="regLast" placeholder="שם משפחה">
                <input type="number" id="regId" placeholder="תעודת זהות">
                <input type="tel" id="regPhone" placeholder="טלפון">
                <input type="text" id="regAddress" placeholder="כתובת מגורים">
                <hr class="my-3">
                <input type="text" id="regPlate" placeholder="מספר רכב">
                <input type="text" id="regCarModel" placeholder="דגם רכב">
                <input type="number" id="regYear" placeholder="שנת ייצור">
                <input type="text" id="regColor" placeholder="צבע">
                <input type="number" id="regKm" placeholder="קילומטראז'">
                <button onclick="handleRegister()" class="w-full bg-blue-900 text-white py-4 rounded-xl font-black mt-4 uppercase">שמור במערכת</button>
            </div>
        </div>
    </div>

    <div id="loginPage" class="hidden p-5 max-w-md mx-auto">
        <button onclick="showPage('homePage')" class="mb-4 text-blue-900 font-bold"><i class="fas fa-chevron-right ml-1"></i> חזרה</button>
        <div class="card p-6 text-center">
            <h2 class="text-xl font-black mb-4 text-blue-900">כניסה לאזור האישי</h2>
            <input type="text" id="loginLast" placeholder="שם משפחה">
            <input type="text" id="loginPlate" placeholder="מספר רכב">
            <button onclick="handleLogin()" class="w-full bg-blue-900 text-white py-4 rounded-xl font-black mt-2">התחבר</button>
        </div>
    </div>

    <div id="clientDashboard" class="hidden p-5 max-w-md mx-auto">
        <div class="card bg-slate-900 text-white p-6 mb-4">
            <p id="carTitle" class="text-xl font-black uppercase"></p>
            <p id="carPlateSub" class="text-blue-400 font-mono text-sm tracking-widest"></p>
        </div>
        <div class="grid grid-cols-2 gap-2 mb-4">
            <div class="card p-3 text-center"><p class="text-[9px] text-blue-500 font-black uppercase">טיפול אחרון</p><b id="lastDate" class="text-xs"></b></div>
            <div class="card p-3 text-center"><p class="text-[9px] text-red-500 font-black uppercase">טיפול הבא</p><b id="nextDate" class="text-xs"></b></div>
        </div>
        <div class="card p-4 mb-4"><h4 class="text-[10px] opacity-50 mb-1 font-black">פירוט עבודה:</h4><p id="lastWork" class="text-sm font-bold"></p></div>
        <button onclick="bookWhatsApp()" class="w-full bg-green-600 text-white py-4 rounded-xl font-black shadow-lg"><i class="fab fa-whatsapp"></i> תאם טיפול בווטסאפ</button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDD7YAdTePRWYjwBbmy3gLRYd_OLDwpTL8",
            authDomain: "baram-vag-45e12.firebaseapp.com",
            projectId: "baram-vag-45e12",
            storageBucket: "baram-vag-45e12.firebasestorage.app",
            messagingSenderId: "761383355945",
            appId: "1:761383355945:web:552554b5a6b9fe5e78be38"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let currentUser = null;

        function updateStatus() {
            const now = new Date();
            const day = now.getDay(); 
            const hour = now.getHours();
            const min = now.getMinutes();
            const totalMin = hour * 60 + min;
            
            const start = 7 * 60 + 30; // 07:30
            const end = 15 * 60 + 30; // 15:30

            const statusEl = document.getElementById('shopStatus');
            document.getElementById('liveTime').innerText = now.toLocaleTimeString('he-IL', {hour: '2-digit', minute:'2-digit'});
            document.getElementById('liveDate').innerText = now.toLocaleDateString('he-IL', {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'});

            if (day >= 0 && day <= 4 && totalMin >= start && totalMin < end) {
                statusEl.innerText = "פתוח כעת";
                statusEl.className = "status-badge status-open";
            } else {
                statusEl.innerText = "סגור כעת";
                statusEl.className = "status-badge status-closed";
            }
        }
        setInterval(updateStatus, 1000);
        updateStatus();

        const reviews = [
            {n: "יוסי לוי", t: "המוסך הכי מקצועי לאאודי בדרום. יחס אישי ומחיר הוגן."},
            {n: "מיכל כהן", t: "פתרו לי תקלה ש-3 מוסכים אחרים לא מצאו. אלופים!"},
            {n: "דניאל", t: "שירות מהיר ומקצועי. מומלץ בחום לבעלי סקודה."},
            {n: "איתי אהרוני", t: "דיאגנוסטיקה ברמה הכי גבוהה שיש. שירות מעולה."},
            {n: "ספיר גואטה", t: "מקום נקי, מסודר ואמין מאוד. לא מחליפה אותם."},
            {n: "רוני ברק", t: "מומחים אמיתיים ל-DSG. הגיר עובד כמו חדש."},
            {n: "אלון מזרחי", t: "תודה רבה על הטיפול המעולה בגולף שלי. מקצוענים."},
            {n: "קובי פרץ", t: "יחס מדהים ושירות VIP. הרגשתי בידיים טובות."},
            {n: "חיים משה", t: "אין על ברע״מ! מוסך ברמה של חו״ל."},
            {n: "יונתן רז", t: "אמינות זה הכל במוסך, וכאן יש בשפע."}
        ];
        const revCont = document.getElementById('reviewsContainer');
        reviews.forEach(r => {
            revCont.innerHTML += `<div class="review-card"><b>${r.n}</b><div class="text-yellow-400 text-[10px] my-1">⭐⭐⭐⭐⭐</div><p>${r.t}</p></div>`;
        });

        const tips = [
            "בדיקת שמן מנוע ב-VAG עושים כשהמנוע חם (5 דקות אחרי כיבוי).",
            "נורת EPC? ייתכן ויש תקלה במערכת ההצתה. כדאי לבדוק.",
            "החלפת נוזל בלמים בברע״מ מומלצת כל שנתיים לשמירה על המערכת.",
            "בפקקים ארוכים, גיר DSG אוהב שתשאיר רווח ואל תזחל על הברקס.",
            "מרגיש רעידות בהגה? כדאי לבדוק איזון גלגלים ופרונט."
        ];
        document.getElementById('dailyTip').innerText = tips[Math.floor(Math.random() * tips.length)];

        function showPage(id) {
            ['homePage', 'registerPage', 'loginPage', 'clientDashboard'].forEach(p => document.getElementById(p).classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        async function askExpertAI() {
            const input = document.getElementById('aiInput').value;
            const resDiv = document.getElementById('aiResponse');
            if(!input) return;
            resDiv.classList.remove('hidden');
            resDiv.innerHTML = "מנתח נתוני יצרן...";
            setTimeout(() => {
                const low = input.toLowerCase();
                if(low.includes("גיר") || low.includes("dsg")) resDiv.innerHTML = "<b>תשובת המומחה:</b> רעידות מעידות לרוב על בלאי מצמדים או צורך בכיול מכטרוניקס. בוא אלינו לבדיקת מחשב.";
                else if(low.includes("נורה") || low.includes("epc")) resDiv.innerHTML = "<b>תשובת המומחה:</b> נורת התראה דורשת חיבור לסורק ODIS מקורי לאיתור קוד תקלה מדויק.";
                else resDiv.innerHTML = "<b>תשובת המומחה:</b> התקלה דורשת בדיקה פיזית. אנחנו בברע״מ נשמח לעזור לך לאבחן אותה במדויק.";
            }, 1000);
        }

        function handleRegister() {
            const plate = document.getElementById('regPlate').value;
            const data = {
                firstName: document.getElementById('regFirst').value,
                lastName: document.getElementById('regLast').value,
                plate: plate, carModel: document.getElementById('regCarModel').value,
                year: document.getElementById('regYear').value,
                lastServiceDate: "חדש", nextServiceDate: "בתיאום", lastServiceWork: "פתיחת כרטיס"
            };
            db.collection("customers").doc(plate).set(data).then(() => { alert("ברוך הבא למרכז שירות ברע״מ!"); showPage('homePage'); });
        }

        function handleLogin() {
            const plate = document.getElementById('loginPlate').value;
            const last = document.getElementById('loginLast').value;
            db.collection("customers").doc(plate).get().then(doc => {
                if(doc.exists && doc.data().lastName === last) {
                    currentUser = doc.data();
                    document.getElementById('userNameDisplay').innerText = "שלום, " + currentUser.firstName;
                    document.getElementById('logoutBtn').classList.remove('hidden');
                    document.getElementById('authButtons').classList.add('hidden');
                    document.getElementById('carTitle').innerText = currentUser.carModel + " " + (currentUser.year || "");
                    document.getElementById('carPlateSub').innerText = currentUser.plate;
                    document.getElementById('lastDate').innerText = currentUser.lastServiceDate;
                    document.getElementById('nextDate').innerText = currentUser.nextServiceDate;
                    document.getElementById('lastWork').innerText = currentUser.lastServiceWork;
                    showPage('clientDashboard');
                } else { alert("פרטי כניסה שגויים"); }
            });
        }

        function bookWhatsApp() {
            window.open(`https://wa.me/972505858750?text=שלום, אני ${currentUser.firstName}, מעוניין לתאם טיפול לרכב ${currentUser.plate}`, '_blank');
        }
    </script>
</body>
</html>
