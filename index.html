<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>מרכז שירות ברע״מ | VAG Expert & CRM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700;800&display=swap');
        body { font-family: 'Assistant', sans-serif; background-color: #f8fafc; }
        .hero-gradient { background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); }
        .card { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .btn-nav { background: #eee; border-radius: 12px; padding: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; font-weight: bold; font-size: 13px; }
        .ai-box { background: #f0f7ff; border: 1px solid #cce3ff; border-radius: 20px; padding: 15px; }
        .hidden { display: none; }
        input, textarea { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 12px; outline: none; background: #fff; }
        .star-rating { color: #fbbf24; font-size: 12px; }
    </style>
</head>
<body>

    <header class="bg-white p-4 text-center border-b sticky top-0 z-50 shadow-sm">
        <h1 class="text-2xl font-extrabold text-blue-900">מרכז שירות ברע״מ</h1>
        <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest leading-tight">VAG SPECIALIST | פנחס החוצב 35</p>
    </header>

    <div id="homePage">
        <section class="hero-gradient text-white pt-8 pb-16 px-6 text-center">
            <h2 class="text-2xl font-bold mb-4">מומחי קבוצת VAG בבאר שבע</h2>
            <div class="grid grid-cols-3 gap-2">
                <a href="tel:086277195" class="btn-nav text-blue-900 bg-white"><i class="fas fa-phone"></i>חיוג</a>
                <a href="https://waze.com/ul?q=פנחס החוצב 35 באר שבע" class="btn-nav text-blue-900 bg-white"><i class="fab fa-waze text-blue-400"></i>ניווט</a>
                <a href="https://wa.me/972505858750" class="btn-nav text-blue-900 bg-white"><i class="fab fa-whatsapp text-green-500"></i>הודעה</a>
            </div>
        </section>

        <div class="max-w-md mx-auto px-4 -mt-8">
            <div class="grid grid-cols-2 gap-3 mb-6">
                <button onclick="showPage('loginPage')" class="card text-center py-6 border-b-4 border-blue-600">
                    <i class="fas fa-user-circle text-3xl text-blue-900 mb-2"></i>
                    <p class="font-bold text-sm">אזור אישי</p>
                </button>
                <button onclick="showPage('registerPage')" class="card text-center py-6 border-b-4 border-green-600">
                    <i class="fas fa-user-plus text-3xl text-green-600 mb-2"></i>
                    <p class="font-bold text-sm">רישום לקוח</p>
                </button>
            </div>

            <div class="ai-box mb-6">
                <div class="flex items-center gap-2 mb-3">
                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white"><i class="fas fa-robot"></i></div>
                    <h3 class="font-bold text-blue-900">שאל את המומחה (AI)</h3>
                </div>
                <textarea id="aiInput" placeholder="תאר את הבעיה ברכב או שאל על טיפול..." rows="2" class="mb-2"></textarea>
                <button onclick="askExpertAI()" id="aiBtn" class="w-full bg-blue-900 text-white p-3 rounded-xl font-bold text-sm">קבל ייעוץ ראשוני</button>
                <div id="aiResponse" class="hidden mt-3 p-3 bg-white border rounded-xl text-xs leading-relaxed text-slate-700"></div>
            </div>

            <h4 class="font-bold text-sm mb-3 px-1 text-slate-600">לקוחות ממליצים</h4>
            <div class="space-y-3 mb-10 text-right">
                <div class="card p-3 text-xs italic">
                    <div class="star-rating mb-1"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                    "המקום הכי מקצועי בבאר שבע לרכבי פולקסווגן. שירות אמין ומהיר."
                    <p class="not-italic font-bold mt-1 text-blue-900">- דוד לוי</p>
                </div>
                <div class="card p-3 text-xs italic">
                    <div class="star-rating mb-1"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                    "טיפול מעולה באאודי שלי, חסכו לי המון כסף לעומת המרכזי."
                    <p class="not-italic font-bold mt-1 text-blue-900">- רמי כהן</p>
                </div>
            </div>
        </div>
    </div>

    <div id="registerPage" class="hidden p-4">
        <button onclick="showPage('homePage')" class="mb-4 text-blue-900 font-bold"><i class="fas fa-arrow-right ml-1"></i> חזרה</button>
        <div class="card">
            <h2 class="text-xl font-bold mb-4">רישום לקוח חדש</h2>
            <div class="grid grid-cols-2 gap-2 mb-3">
                <input type="text" id="regFirst" placeholder="שם פרטי">
                <input type="text" id="regLast" placeholder="שם משפחה">
            </div>
            <input type="tel" id="regPhone" placeholder="טלפון" class="mb-3">
            <input type="number" id="regId" placeholder="תעודת זהות" class="mb-3">
            <input type="text" id="regAddress" placeholder="כתובת" class="mb-3">
            <div class="grid grid-cols-2 gap-2 mb-3">
                <input type="text" id="regCarModel" placeholder="סוג רכב">
                <input type="text" id="regColor" placeholder="צבע">
            </div>
            <div class="grid grid-cols-2 gap-2 mb-3">
                <input type="text" id="regPlate" placeholder="מספר רכב">
                <input type="number" id="regYear" placeholder="שנה">
            </div>
            <input type="number" id="regKm" placeholder="קילומטראז'" class="mb-4">
            <button onclick="handleRegister()" class="w-full bg-blue-900 text-white p-4 rounded-xl font-bold">שמור והצטרף</button>
        </div>
    </div>

    <div id="loginPage" class="hidden p-4">
        <button onclick="showPage('homePage')" class="mb-4 text-blue-900 font-bold"><i class="fas fa-arrow-right ml-1"></i> חזרה</button>
        <div class="card">
            <h2 class="text-xl font-bold mb-4">כניסה ללקוח רשום</h2>
            <input type="text" id="loginLast" placeholder="שם משפחה" class="mb-3">
            <input type="text" id="loginPlate" placeholder="מספר רכב" class="mb-4">
            <button onclick="handleLogin()" class="w-full bg-blue-900 text-white p-4 rounded-xl font-bold">התחבר</button>
        </div>
    </div>

    <div id="clientDashboard" class="hidden p-4">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">שלום, <span id="clientNameDisplay"></span></h2>
            <button onclick="location.reload()" class="text-red-500 text-xs">יציאה</button>
        </div>
        <div class="card bg-slate-900 text-white mb-4">
            <p id="carInfoDisplay" class="text-lg font-bold"></p>
            <p id="plateDisplay" class="text-xs opacity-60"></p>
        </div>
        <button onclick="bookWhatsApp()" class="w-full bg-green-600 text-white p-4 rounded-xl font-bold mb-4 flex items-center justify-center gap-2">
            <i class="fab fa-whatsapp"></i> הזמן תור לטיפול
        </button>
        <div class="grid grid-cols-2 gap-2 mb-4">
            <div class="card p-3 text-center"><p class="text-[10px] text-blue-500">טיפול אחרון</p><b id="lastService" class="text-xs"></b></div>
            <div class="card p-3 text-center"><p class="text-[10px] text-red-500">טיפול הבא</p><b id="nextService" class="text-xs"></b></div>
        </div>
        <div class="card mb-2 text-xs"><p class="opacity-50">בוצע:</p><p id="lastDetails" class="font-bold"></p></div>
        <div class="card border-r-4 border-red-500 text-xs"><p class="text-red-500 font-bold">דגש לטיפול הבא:</p><p id="nextDetails" class="font-bold"></p></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDD7YAdTePRWYjwBbmy3gLRYd_OLDwpTL8",
            authDomain: "baram-vag-45e12.firebaseapp.com",
            projectId: "baram-vag-45e12",
            storageBucket: "baram-vag-45e12.firebasestorage.app",
            messagingSenderId: "761383355945",
            appId: "1:761383355945:web:552554b5a6b9fe5e78be38"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let currentUser = null;

        function showPage(id) {
            ['homePage', 'registerPage', 'loginPage', 'clientDashboard'].forEach(p => document.getElementById(p).classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            window.scrollTo(0,0);
        }

        async function askExpertAI() {
            const input = document.getElementById('aiInput').value;
            const resDiv = document.getElementById('aiResponse');
            const btn = document.getElementById('aiBtn');
            if(!input) return;

            btn.innerText = "המומחה חושב...";
            resDiv.classList.remove('hidden');
            resDiv.innerText = "בודק את נתוני היצרן עבורך...";

            // סימולציה של תשובת מומחה VAG מבוססת AI
            setTimeout(() => {
                const answers = [
                    "בביקור הבא נבדוק את מפלס השמן. ברכבי VAG מומלץ להשתמש בתקן 504.00/507.00.",
                    "רעשים מהפרונט עשויים להעיד על תושבות מנוע או משולשים. מומלץ להגיע לבדיקה חזותית.",
                    "נורת EPC דורשת חיבור לסורק תקלות. לעיתים מדובר בחיישן פשוט או מצערת.",
                    "החלפת שמן גיר ב-DSG מומלצת בכל 60,000 ק״מ כדי לשמור על המוח ההידראולי."
                ];
                resDiv.innerText = answers[Math.floor(Math.random() * answers.length)] + "\n\nשים לב: זוהי הערכה ראשונית, תמיד מומלץ לתאם בדיקה פיזית במוסך.";
                btn.innerText = "קבל ייעוץ נוסף";
            }, 2000);
        }

        function handleRegister() {
            const plate = document.getElementById('regPlate').value;
            const data = {
                firstName: document.getElementById('regFirst').value, lastName: document.getElementById('regLast').value,
                phone: document.getElementById('regPhone').value, plate: plate, year: document.getElementById('regYear').value,
                carModel: document.getElementById('regCarModel').value, km: document.getElementById('regKm').value,
                lastServiceDate: "טרם בוצע", nextServiceDate: "יקבע בביקור", lastServiceWork: "רישום למערכת", nextServiceWork: "בדיקה כללית"
            };
            db.collection("customers").doc(plate).set(data).then(() => { alert("נרשמת בהצלחה!"); showPage('homePage'); });
        }

        function handleLogin() {
            const plate = document.getElementById('loginPlate').value;
            const lastName = document.getElementById('loginLast').value;
            db.collection("customers").doc(plate).get().then(doc => {
                if (doc.exists && doc.data().lastName === lastName) {
                    currentUser = doc.data();
                    document.getElementById('clientNameDisplay').innerText = currentUser.firstName;
                    document.getElementById('carInfoDisplay').innerText = currentUser.carModel + " " + currentUser.year;
                    document.getElementById('plateDisplay').innerText = "מספר רכב: " + currentUser.plate;
                    document.getElementById('lastService').innerText = currentUser.lastServiceDate;
                    document.getElementById('nextService').innerText = currentUser.nextServiceDate;
                    document.getElementById('lastDetails').innerText = currentUser.lastServiceWork;
                    document.getElementById('nextDetails').innerText = currentUser.nextServiceWork;
                    showPage('clientDashboard');
                } else { alert("פרטים לא נכונים"); }
            });
        }

        function bookWhatsApp() {
            const msg = `שלום, אני ${currentUser.firstName} (${currentUser.plate}), מעוניין להזמין תור לטיפול במוסך.`;
            window.open(`https://wa.me/972505858750?text=${msg}`, '_blank');
        }
    </script>
</body>
</html>
