<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>מרכז שירות ברע״מ - VAG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700;800&display=swap');
        body { font-family: 'Assistant', sans-serif; background-color: #f8fafc; color: #1e293b; overflow-x: hidden; }
        .ltr { direction: ltr; display: inline-block; }
        .hero-gradient { background: linear-gradient(135deg, #0f172a 0%, #1e40af 100%); color: white; padding: 40px 20px 100px 20px; clip-path: ellipse(150% 100% at 50% 0%); }
        .services-container { margin-top: -60px; padding: 0 15px; position: relative; z-index: 10; }
        .card { background: white; border-radius: 20px; border: 1px solid #e2e8f0; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .review-section { background: #0f172a; border-radius: 40px 40px 0 0; padding: 40px 20px; color: white; }
        .hidden { display: none !important; }
        input:invalid { border-color: #ef4444; }
    </style>
</head>
<body>

    <header class="bg-white p-4 text-center border-b sticky top-0 z-[100]">
        <h1 class="text-2xl font-black text-blue-900 leading-tight">מרכז שירות ברע״מ</h1>
        <p class="text-blue-600 font-bold text-sm">באר שבע</p>
        
        <div class="mt-2 bg-blue-50 py-1.5 px-4 rounded-full inline-block border border-blue-100">
            <p id="liveClock" class="text-blue-900 font-bold text-xs ltr"></p>
        </div>
        
        <div class="mt-2 text-[10px] font-bold text-gray-400 flex items-center justify-center gap-2">
            <i class="far fa-clock"></i>
            <span>א׳-ה׳ <span class="ltr">07:30 - 15:30</span> | ו׳-ש׳: סגור</span>
        </div>
    </header>

    <div id="homePage">
        <section class="hero-gradient text-center">
            <h2 class="text-3xl font-black italic mb-1">מומחי VAG</h2>
            <p class="text-blue-100 text-[10px] font-bold tracking-widest uppercase">Audi • VW • Skoda • Seat</p>
        </section>

        <div class="services-container max-w-lg mx-auto">
            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="card p-4 text-center"><i class="fas fa-laptop-code text-blue-600 text-xl mb-1"></i><p class="font-bold text-[11px]">דיאגנוסטיקה</p></div>
                <div class="card p-4 text-center"><i class="fas fa-cogs text-blue-600 text-xl mb-1"></i><p class="font-bold text-[11px]">גירים DSG</p></div>
                <div class="card p-4 text-center"><i class="fas fa-oil-can text-blue-600 text-xl mb-1"></i><p class="font-bold text-[11px]">טיפולים</p></div>
                <div class="card p-4 text-center"><i class="fas fa-snowflake text-blue-600 text-xl mb-1"></i><p class="font-bold text-[11px]">מיזוג</p></div>
                <div class="card p-4 text-center"><i class="fas fa-bolt text-blue-600 text-xl mb-1"></i><p class="font-bold text-[11px]">חשמל</p></div>
                <div class="card p-4 text-center"><i class="fas fa-shield-alt text-blue-600 text-xl mb-1"></i><p class="font-bold text-[11px]">הכנה לטסט</p></div>
            </div>

            <div class="bg-amber-50 border-r-4 border-amber-400 p-4 rounded-xl mb-6 flex gap-3">
                <i class="fas fa-lightbulb text-amber-500 mt-1"></i>
                <div id="tipContent">
                    <span class="block font-bold text-[10px] text-amber-800 uppercase">טיפ יומי</span>
                    <p id="dailyTip" class="text-[11px] text-gray-700 font-medium"></p>
                </div>
            </div>

            <div class="card p-5 border-2 border-blue-50 mb-6">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 bg-slate-900 rounded-xl flex items-center justify-center text-white"><i class="fas fa-robot"></i></div>
                    <span class="font-bold text-sm">שאל את Gemini VAG</span>
                </div>
                <div id="aiRes" class="hidden p-3 bg-blue-50 rounded-xl text-[11px] mb-3 border-r-4 border-blue-900"></div>
                <div class="relative">
                    <input type="text" id="aiInput" placeholder="תאר את התקלה..." class="w-full p-4 bg-gray-50 rounded-2xl text-xs outline-none focus:bg-white transition-all">
                    <button onclick="askAI()" class="absolute left-2 top-2 bg-blue-900 text-white w-9 h-9 rounded-xl flex items-center justify-center shadow-lg"><i class="fas fa-paper-plane text-[10px]"></i></button>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3 mb-6">
                <a href="tel:086277195" class="bg-green-500 text-white p-4 rounded-2xl font-bold text-center shadow-lg">
                    <i class="fas fa-phone-alt ml-2"></i> <span class="ltr">08-6277195</span>
                </a>
                <a href="https://waze.com/ul?q=פנחס החוצב 35 באר שבע" class="bg-white text-gray-700 border p-4 rounded-2xl font-bold text-center">
                    <i class="fas fa-location-arrow ml-2 text-blue-600"></i> ניווט למוסך
                </a>
            </div>

            <div class="grid grid-cols-2 gap-3 mb-10">
                <button onclick="showPage('login')" class="bg-blue-900 text-white p-4 rounded-2xl font-bold">אזור אישי</button>
                <button onclick="showPage('register')" class="bg-blue-50 text-blue-900 border border-blue-200 p-4 rounded-2xl font-bold italic underline">הרשמה ללקוח</button>
            </div>
        </div>

        <section class="review-section">
            <h3 class="text-center font-bold mb-6 italic italic">לקוחות מדרגים 5.0 ★</h3>
            <div id="reviewsScroll" class="flex overflow-x-auto gap-4 no-scrollbar pb-6 px-4">
                </div>
        </section>
    </div>

    <div id="registerPage" class="hidden p-6 max-w-lg mx-auto bg-white min-h-screen">
        <button onclick="showPage('home')" class="text-blue-600 font-bold mb-6"><i class="fas fa-arrow-right ml-2"></i> חזרה</button>
        <h2 class="text-2xl font-black text-blue-900 mb-6 italic">הרשמה למערכת</h2>
        <form onsubmit="event.preventDefault(); registerUser();" class="space-y-4">
            <div class="grid grid-cols-2 gap-3">
                <input type="text" id="regFName" placeholder="שם מלא *" required class="p-4 bg-gray-50 rounded-xl w-full">
                <input type="text" id="regLName" placeholder="שם משפחה *" required class="p-4 bg-gray-50 rounded-xl w-full">
            </div>
            <input type="text" id="regID" placeholder="תעודת זהות *" required class="p-4 bg-gray-50 rounded-xl w-full ltr">
            <input type="tel" id="regPhone" placeholder="טלפון *" required class="p-4 bg-gray-50 rounded-xl w-full ltr">
            <input type="text" id="regAddr" placeholder="כתובת *" required class="p-4 bg-gray-50 rounded-xl w-full">
            <div class="grid grid-cols-2 gap-3">
                <input type="text" id="regModel" placeholder="דגם רכב *" required class="p-4 bg-gray-50 rounded-xl w-full">
                <input type="number" id="regYear" placeholder="שנה *" required class="p-4 bg-gray-50 rounded-xl w-full ltr">
            </div>
            <input type="number" id="regKm" placeholder="קילומטר עדכני *" required class="p-4 bg-gray-50 rounded-xl w-full ltr">
            <input type="text" id="regPlate" placeholder="מספר רכב *" required class="p-4 bg-gray-50 rounded-xl w-full font-bold text-center text-xl ltr">
            <button type="submit" class="w-full bg-blue-900 text-white p-5 rounded-2xl font-black shadow-xl">סיום והרשמה</button>
        </form>
    </div>

    <div id="userPage" class="hidden p-6 max-w-lg mx-auto bg-white min-h-screen">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-black text-blue-900">שלום, <span id="userName">אורח</span></h2>
            <button onclick="logout()" class="text-red-500 text-xs font-bold">התנתק</button>
        </div>

        <div class="card p-5 mb-6 bg-slate-50">
            <h3 class="font-bold text-xs text-gray-400 mb-4 uppercase">נתוני רכב וטיפולים</h3>
            <div class="grid grid-cols-2 gap-4 text-xs font-bold text-blue-900">
                <div class="bg-white p-3 rounded-lg border">טיפול קודם: <br><span id="lastService" class="text-gray-500 ltr">--/--/--</span></div>
                <div class="bg-white p-3 rounded-lg border">טיפול הבא: <br><span id="nextService" class="text-gray-500 ltr">--/--/--</span></div>
                <div class="bg-white p-3 rounded-lg border">טסט קודם: <br><span id="lastTest" class="text-gray-500 ltr">--/--/--</span></div>
                <div class="bg-white p-3 rounded-lg border">טסט הבא: <br><span id="nextTest" class="text-gray-500 ltr">--/--/--</span></div>
            </div>
            <div id="seasonAlert" class="mt-4 hidden p-3 bg-blue-900 text-white rounded-xl text-center text-[10px] animate-pulse"></div>
        </div>

        <div class="card p-5 mb-6">
            <h3 class="font-bold mb-4 italic text-sm"><i class="fas fa-calendar-alt ml-2"></i>קביעת תור חדש</h3>
            <div class="space-y-3">
                <div class="grid grid-cols-2 gap-2">
                    <input type="date" id="bookDate" class="p-3 bg-gray-50 rounded-xl text-xs outline-none">
                    <select id="bookTime" class="p-3 bg-gray-50 rounded-xl text-xs outline-none ltr">
                        <option>07:30</option><option>08:30</option><option>09:30</option>
                        <option>10:30</option><option>11:30</option><option>12:30</option>
                    </select>
                </div>
                <button onclick="bookAppt()" class="w-full bg-blue-600 text-white p-4 rounded-xl font-bold text-xs">שריין תור</button>
                <div id="myAppts" class="mt-4 text-[10px] border-t pt-3"></div>
            </div>
        </div>

        <div class="card p-5">
            <h3 class="font-bold mb-4 text-sm"><i class="fas fa-envelope ml-2 text-blue-600"></i>תיבת הודעות</h3>
            <div id="userMessages" class="space-y-2 text-[11px]">
                <p class="text-gray-400 italic">אין הודעות חדשות...</p>
            </div>
        </div>
    </div>

    <div id="loginPage" class="hidden p-10 max-w-lg mx-auto text-center min-h-screen">
        <button onclick="showPage('home')" class="text-blue-600 font-bold mb-10 block text-right">חזרה</button>
        <i class="fas fa-user-circle text-6xl text-blue-100 mb-4"></i>
        <h2 class="text-xl font-black mb-6">כניסה למערכת</h2>
        <input type="text" id="loginPlate" placeholder="מספר רכב" class="w-full p-5 bg-gray-50 rounded-2xl font-black text-center text-xl ltr mb-4">
        <button onclick="loginUser()" class="w-full bg-blue-900 text-white p-5 rounded-2xl font-black">התחבר</button>
    </div>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDD7YAdTePRWYjwBbmy3gLRYd_OLDwpTL8",
            authDomain: "baram-vag-45e12.firebaseapp.com",
            projectId: "baram-vag-45e12",
            storageBucket: "baram-vag-45e12.firebasestorage.app",
            messagingSenderId: "761383355945",
            appId: "1:761383355945:web:552554b5a6b9fe5e78be38"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 1. Live Clock & Israel Season Logic
        function updateClock() {
            const now = new Date();
            document.getElementById('liveClock').innerText = now.toLocaleString('he-IL', { weekday:'long', day:'numeric', month:'long', hour:'2-digit', minute:'2-digit', second:'2-digit'});
            
            // Winter/Summer Checks (Israel)
            const month = now.getMonth() + 1;
            const alertBox = document.getElementById('seasonAlert');
            if(month >= 11 || month <= 2) {
                alertBox.innerText = "❄️ חורף בפתח! הזמן עכשיו ביקורת חורף בחינם למערכות בטיחות";
                alertBox.classList.remove('hidden');
            } else if(month >= 4 && month <= 6) {
                alertBox.innerText = "☀️ מתכוננים לקיץ! בוא לבדיקת מיזוג אוויר ונוזל קירור";
                alertBox.classList.remove('hidden');
            }
        }
        setInterval(updateClock, 1000); updateClock();

        // 2. Reviews Generator
        const reviews = ["מומחים אמיתיים!", "שירות אדיב ושקוף.", "יניב אלוף הגירים!", "האאודי שלי רק שם.", "מחיר הוגן ומקצועיות.", "המוסך הכי נקי בדרום.", "תודה על השירות המהיר.", "מקצוענים ב-VAG.", "ממליץ לכל מי שיש לו סקודה.", "אין עליכם ברע\"מ!"];
        reviews.forEach(r => {
            document.getElementById('reviewsScroll').innerHTML += `
                <div class="bg-white/5 border border-white/10 p-5 rounded-3xl min-w-[250px]">
                    <div class="text-yellow-400 text-[10px] mb-2">${'<i class="fas fa-star"></i>'.repeat(5)}</div>
                    <p class="text-[11px] opacity-80 italic">"${r}"</p>
                </div>`;
        });

        // 3. Tip Generator
        const tips = ["בדיקת לחץ אוויר בצמיגים חוסכת עד 3% בצריכת הדלק.","החלפת שמן גיר DSG כל 60 אלף ק\"מ היא חובה לשמירה על המוח.","נורת אוריאה דולקת? אל תחכו לקילומטר האחרון.","מים רגילים ברדיאטור גורמים לקורוזיה - השתמשו רק ב-G12/G13."];
        document.getElementById('dailyTip').innerText = tips[new Date().getDay() % tips.length];

        // 4. Navigation
        function showPage(p) {
            ['homePage', 'registerPage', 'loginPage', 'userPage'].forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById(p + 'Page').classList.remove('hidden');
            window.scrollTo(0,0);
        }

        // 5. Register Logic
        async function registerUser() {
            const user = {
                firstName: document.getElementById('regFName').value,
                lastName: document.getElementById('regLName').value,
                id: document.getElementById('regID').value,
                phone: document.getElementById('regPhone').value,
                address: document.getElementById('regAddr').value,
                carModel: document.getElementById('regModel').value,
                year: document.getElementById('regYear').value,
                km: document.getElementById('regKm').value,
                plate: document.getElementById('regPlate').value,
                lastService: "טרם בוצע", nextService: "6 חודשים", lastTest: "טרם עודכן", nextTest: "טרם עודכן",
                messages: [{from: "מערכת", text: "ברוך הבא למרכז שירות ברע\"מ!"}],
                createdAt: new Date()
            };
            try {
                await db.collection("customers").doc(user.plate).set(user);
                alert("נרשמת בהצלחה! התחבר כעת.");
                showPage('login');
            } catch (e) { alert("שגיאה ברישום."); }
        }

        // 6. Login & Session
        let currentUser = null;
        async function loginUser() {
            const plate = document.getElementById('loginPlate').value;
            const doc = await db.collection("customers").doc(plate).get();
            if(doc.exists) {
                currentUser = doc.data();
                loadUserArea();
                showPage('user');
                if (Notification.permission === "granted") {
                    new Notification("מרכז שירות ברע״מ", { body: "התחברת בהצלחה לאזור האישי!" });
                } else { Notification.requestPermission(); }
            } else { alert("מספר רכב לא נמצא במערכת."); }
        }

        function loadUserArea() {
            document.getElementById('userName').innerText = currentUser.firstName;
            document.getElementById('lastService').innerText = currentUser.lastService;
            document.getElementById('nextService').innerText = currentUser.nextService;
            document.getElementById('lastTest').innerText = currentUser.lastTest;
            document.getElementById('nextTest').innerText = currentUser.nextTest;
            
            // Messages
            const msgBox = document.getElementById('userMessages');
            msgBox.innerHTML = currentUser.messages.map(m => `<div class="p-3 bg-gray-50 rounded-lg border-r-4 border-blue-900"><b>${m.from}:</b> ${m.text}</div>`).join('');
            
            // Load Appointments
            loadAppts();
        }

        async function loadAppts() {
            const snap = await db.collection("appointments").where("plate", "==", currentUser.plate).get();
            const list = document.getElementById('myAppts');
            list.innerHTML = "<b>התורים שלי:</b>";
            snap.forEach(doc => {
                const a = doc.data();
                list.innerHTML += `<div class="flex justify-between items-center bg-blue-50 p-2 mt-2 rounded">
                    <span>${a.date} בשעה ${a.time}</span>
                    <button onclick="cancelAppt('${doc.id}')" class="text-red-500">ביטול</button>
                </div>`;
            });
        }

        async function bookAppt() {
            const date = document.getElementById('bookDate').value;
            const time = document.getElementById('bookTime').value;
            if(!date) return;
            await db.collection("appointments").add({ plate: currentUser.plate, date, time, status: "ממתין" });
            alert("תור נקבע בהצלחה!");
            loadAppts();
        }

        async function cancelAppt(id) {
            if(confirm("לבטל תור זה?")) {
                await db.collection("appointments").doc(id).delete();
                loadAppts();
            }
        }

        function logout() { currentUser = null; showPage('home'); }

        // 7. Gemini AI Integration
        async function askAI() {
            const input = document.getElementById('aiInput').value;
            const resBox = document.getElementById('aiRes');
            if(!input) return;
            resBox.classList.remove('hidden');
            resBox.innerHTML = "מנתח נתונים...";
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${firebaseConfig.apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: `אתה מומחה טכני של מרכז שירות ברע"מ. ענה בקצרה ובעברית רק על שאלות הקשורות לקבוצת VAG (אאודי, סקודה, פולקסווגן, סיאט). שאלה: ${input}` }] }] })
                });
                const data = await response.json();
                resBox.innerHTML = "<b>Gemini VAG:</b> " + data.candidates[0].content.parts[0].text;
            } catch (e) { resBox.innerHTML = "שגיאה בתקשורת עם השרת."; }
        }
    </script>
</body>
</html>
