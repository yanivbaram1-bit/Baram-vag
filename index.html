<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מרכז שירות ברע״מ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;700;800&display=swap');
        body { font-family: 'Assistant', sans-serif; background-color: #f4f7ff; color: #001e50; }
        .grid-card { background: white; border-radius: 1.5rem; padding: 1.5rem; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,30,80,0.05); text-align: center; border: 1px solid #e2e8f0; transition: transform 0.2s; }
        .grid-card:active { transform: scale(0.95); }
        .grid-card i { font-size: 2rem; color: #2563eb; margin-bottom: 0.75rem; }
        .grid-card span { font-weight: 800; font-size: 0.9rem; }
        .ai-box { background: white; border-radius: 2rem; border: 2px solid #2563eb; padding: 1.5rem; margin-top: 2rem; box-shadow: 0 10px 30px rgba(37,99,235,0.1); }
        .input-login { @apply w-full p-4 bg-slate-100 rounded-2xl border-none outline-none font-bold text-center mb-3; }
    </style>
</head>
<body class="p-4 pt-8">

    <div class="text-center mb-8">
        <h1 class="text-2xl font-black text-[#001e50]">מרכז שירות ברע״מ בע״מ</h1>
    </div>

    <div id="homeView">
        <div class="grid grid-cols-2 gap-4">
            <button onclick="showLogin()" class="grid-card border-b-4 border-blue-600">
                <i class="fas fa-sign-in-alt"></i>
                <span>כניסת לקוח</span>
            </button>
            <button onclick="scrollToRegister()" class="grid-card">
                <i class="fas fa-id-card"></i>
                <span>פתיחת כרטיס</span>
            </button>
            
            <div class="grid-card">
                <i class="fas fa-microchip"></i>
                <span>דיאגנוסטיקה</span>
            </div>
            <div class="grid-card">
                <i class="fas fa-wrench"></i>
                <span>טיפול תקופתי</span>
            </div>
            
            <div class="grid-card">
                <i class="fas fa-cog"></i>
                <span>גיר DSG</span>
            </div>
            <div class="grid-card">
                <i class="fas fa-snowflake"></i>
                <span>מיזוג אוויר</span>
            </div>
        </div>

        <div class="ai-box mt-8">
            <div class="flex items-center gap-2 mb-4">
                <i class="fas fa-robot text-blue-600 text-xl"></i>
                <h3 class="font-black text-sm">המומחה הווירטואלי של ברע״מ</h3>
            </div>
            <input id="aiIn" type="text" placeholder="שאל אותי על הרכב שלך..." class="w-full p-4 bg-slate-50 rounded-xl border border-slate-200 mb-3 font-bold outline-none">
            <button onclick="askAIGlobal()" class="w-full bg-[#001e50] text-white p-4 rounded-xl font-bold">שאלה נוספת</button>
            
            <div id="aiResponse" class="mt-4 p-4 bg-blue-50 rounded-xl hidden">
                <p class="text-[10px] font-black mb-1 opacity-50 uppercase tracking-tighter">תשובת מומחה ברע״מ:</p>
                <p id="aiText" class="text-sm font-bold leading-relaxed"></p>
            </div>
        </div>

        <div id="registerSection" class="mt-12 bg-white p-8 rounded-[2.5rem] shadow-lg border border-slate-100">
            <h2 class="text-xl font-black mb-4">לקוח חדש?</h2>
            <input id="regName" type="text" placeholder="שם מלא" class="input-login bg-slate-50 border border-slate-100">
            <input id="regPlate" type="tel" placeholder="מספר רכב" class="input-login bg-slate-50 border border-slate-100">
            <button onclick="alert('הפרטים נשלחו!')" class="w-full bg-blue-600 text-white p-4 rounded-2xl font-black">שלח בקשה</button>
        </div>
    </div>

    <div id="dashSection" class="hidden space-y-4">
        <div class="bg-[#001e50] text-white p-6 rounded-[2rem] flex justify-between items-center">
            <div>
                <h2 id="clientName" class="text-lg font-black"></h2>
                <p id="carInfo" class="text-xs opacity-60"></p>
            </div>
            <div id="plateBadge" class="bg-yellow-400 text-black px-3 py-1 rounded font-black text-sm border-2 border-black"></div>
        </div>

        <div class="bg-white p-6 rounded-[2rem] text-center shadow-sm border border-slate-100">
            <p class="text-[10px] font-black opacity-30 uppercase">סטטוס נוכחי</p>
            <h3 id="carStatus" class="text-xl font-black text-blue-600"></h3>
        </div>

        <div id="quoteArea" class="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100">
            <h3 class="font-black mb-4 border-b pb-2">הצעת מחיר לאישור</h3>
            <div id="itemsContainer" class="space-y-2 mb-4 text-sm"></div>
            <div class="bg-blue-50 p-4 rounded-xl flex justify-between font-black mb-6">
                <span>סה"כ:</span><span id="finalTotal"></span>
            </div>
            
            <div id="signatureArea">
                <p class="text-xs font-bold mb-2">חתימה לאישור:</p>
                <canvas id="sig-canvas" style="width:100%; height:120px; border:2px dashed #ccc; border-radius:1rem; background:#fafafa;"></canvas>
                <div class="flex gap-2 mt-3">
                    <button onclick="clearSig()" class="bg-slate-100 px-4 py-3 rounded-xl text-xs font-bold">נקה</button>
                    <button onclick="approveQuote()" class="flex-1 bg-emerald-600 text-white py-3 rounded-xl font-black">אשר וחתום</button>
                </div>
            </div>
        </div>
    </div>

    <div id="loginModal" class="fixed inset-0 bg-[#001e50]/95 backdrop-blur-sm z-[2000] hidden flex items-center justify-center p-6 text-white">
        <div class="w-full max-w-xs text-center">
            <h2 class="text-2xl font-black mb-6">זיהוי לקוח</h2>
            <input id="pIn" type="tel" placeholder="מספר רכב" class="input-login text-black">
            <input id="iIn" type="tel" placeholder="תעודת זהות (9 ספרות)" class="input-login text-black">
            <button onclick="attemptLogin()" class="w-full bg-blue-600 p-5 rounded-2xl font-black shadow-lg">הצג סטטוס טיפול</button>
            <button onclick="hideLogin()" class="mt-4 opacity-50 text-xs">ביטול</button>
        </div>
    </div>

    <script>
        // אותן הגדרות Firebase מקודם
        const firebaseConfig = {
            apiKey: "AIzaSyDD7YAdTePRWYjwBbmy3gLRYd_OLDwpTL8",
            authDomain: "baram-vag-45e12.firebaseapp.com",
            projectId: "baram-vag-45e12",
            storageBucket: "baram-vag-45e12.firebasestorage.app",
            messagingSenderId: "761383355945",
            appId: "1:761383355945:web:552554b5a6b9fe5e78be38"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let clientData = null;

        function showLogin() { document.getElementById('loginModal').classList.remove('hidden'); }
        function hideLogin() { document.getElementById('loginModal').classList.add('hidden'); }
        function scrollToRegister() { document.getElementById('registerSection').scrollIntoView({behavior:'smooth'}); }

        async function attemptLogin() {
            const plate = document.getElementById('pIn').value;
            const id = document.getElementById('iIn').value;
            const doc = await db.collection("customers").doc(plate).get();
            if(doc.exists && doc.data().idNum === id) {
                clientData = doc.data();
                showDashboard();
            } else { alert("פרטים לא נכונים"); }
        }

        function showDashboard() {
            hideLogin();
            document.getElementById('homeView').classList.add('hidden');
            document.getElementById('dashSection').classList.remove('hidden');
            document.getElementById('clientName').innerText = "שלום, " + clientData.fName;
            document.getElementById('carInfo').innerText = clientData.model;
            document.getElementById('plateBadge').innerText = clientData.plate;
            document.getElementById('carStatus').innerText = clientData.status;
            document.getElementById('finalTotal').innerText = clientData.total;
            // ... (שאר הלוגיקה של הרינדור והחתימה נשארת זהה)
        }

        function askAIGlobal() {
            const q = document.getElementById('aiIn').value;
            const resBox = document.getElementById('aiResponse');
            const resText = document.getElementById('aiText');
            resBox.classList.remove('hidden');
            resText.innerText = "נראה שהשאלה שלך לא קשורה לתחום הרכב. אני מומחה לאבחון תקלות בקבוצת VAG (אאודי, פולקסווגן, סקודה וסיאט). איך אוכל לעזור לך עם הרכב היום?";
        }
    </script>
</body>
</html>
